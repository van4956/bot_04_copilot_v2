Analyze the bot_04_copilot_v2 repository.

README:
# Telegram Bot Copilot v2

*–≤—Ç–æ—Ä–∞—è –≤–µ—Ä—Å–∏—è –±–æ—Ç–∞ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω—É–∂–¥*


Repository Structure: bot_04_copilot_v2
/.dockerignore
/.env.example
/.gitignore
/Dockerfile
/LICENSE
/README.md
/app.py
/common/
/config_data/
/database/
/docker-compose.yml
/filters/
/handlers/
/locales/
/middlewares/
/prescription.txt
/requirements.txt
/testing/
/testing/gpt.py
/testing/ice.py
/middlewares/counter.py
/middlewares/db.py
/middlewares/locale.py
/middlewares/throttle.py
/locales/en/
/locales/ru/
/locales/ru/LC_MESSAGES/
/locales/ru/LC_MESSAGES/bot_00_template.po
/locales/en/LC_MESSAGES/
/locales/en/LC_MESSAGES/bot_00_template.po
/handlers/admin.py
/handlers/cookbook.py
/handlers/currency.py
/handlers/donate.py
/handlers/group.py
/handlers/llm.py
/handlers/other.py
/handlers/owner.py
/handlers/private.py
/handlers/start.py
/handlers/weather.py
/filters/chat_type.py
/filters/find_usernames.py
/filters/is_admin.py
/filters/is_owner.py
/filters/member_can_restrict.py
/database/influxdb/
/database/models.py
/database/orm_cookbook.py
/database/orm_users.py
/database/postgres/
/database/postgres/.gitkeep
/database/influxdb/.gitkeep
/config_data/config.py
/common/comands.py
/common/image_cat/
/common/images/
/common/keyboard.py
/common/text_list_.py
/common/images/image_about.jpg
/common/images/image_updates.jpg
/common/image_cat/100030.jpg
/common/image_cat/photo_2024-02-28_21-43-11.jpg
/common/image_cat/photo_2024-02-28_21-43-50.jpg
/common/image_cat/photo_2024-02-28_21-44-47.jpg
/common/image_cat/photo_2024-02-28_21-46-45.jpg
/common/image_cat/photo_2024-02-28_21-48-57.jpg
/common/image_cat/photo_2024-02-28_21-49-51.jpg
/common/image_cat/photo_2024-02-28_21-50-18.jpg
/common/image_cat/photo_2024-02-28_21-50-28.jpg
/common/image_cat/photo_2024-02-28_21-50-54.jpg
/common/image_cat/photo_2024-02-28_21-55-46.jpg
/common/image_cat/photo_2024-02-28_21-55-53.jpg
/common/image_cat/photo_2024-02-28_21-56-04.jpg
/common/image_cat/photo_2024-02-28_21-56-16.jpg
/common/image_cat/photo_2024-02-28_21-56-26.jpg
/common/image_cat/photo_2024-02-28_21-56-43.jpg
/common/image_cat/photo_2024-02-28_21-57-03.jpg
/common/image_cat/photo_2024-02-28_21-57-16.jpg
/common/image_cat/photo_2024-02-28_21-57-23.jpg
/common/image_cat/photo_2024-02-28_21-57-24.jpg
/common/image_cat/photo_2024-02-28_21-57-26.jpg
/common/image_cat/photo_2024-02-28_21-57-30.jpg
/common/image_cat/photo_2024-02-28_21-57-43.jpg
/common/image_cat/photo_2024-02-28_21-57-45.jpg
/common/image_cat/photo_2024-02-28_21-57-58.jpg
/common/image_cat/photo_2024-02-28_21-58-21.jpg
/common/image_cat/photo_2024-02-28_21-58-23.jpg
/common/image_cat/photo_2024-02-28_21-58-25.jpg
/common/image_cat/photo_2024-02-28_21-59-05.jpg
/common/image_cat/photo_2024-02-28_21-59-14.jpg
/common/image_cat/photo_2024-02-28_21-59-36.jpg
/common/image_cat/photo_2024-08-14_08-22-15.jpg
/common/image_cat/photo_2024-11-10_19-36-38.jpg
/common/image_cat/photo_2024-11-10_19-36-44.jpg
/common/image_cat/photo_2024-11-10_19-36-47.jpg
/common/image_cat/photo_2024-11-10_19-36-49.jpg
/common/image_cat/photo_2024-11-10_19-37-00.jpg
/common/image_cat/photo_2024-11-10_19-37-10.jpg
/common/image_cat/photo_2024-11-10_19-37-21.jpg
/common/image_cat/photo_2024-11-10_19-37-26.jpg
/common/image_cat/photo_2024-11-10_19-37-29.jpg
/common/image_cat/photo_2024-11-10_19-37-34.jpg
/common/image_cat/photo_2024-11-10_19-37-41.jpg
/common/image_cat/photo_2024-11-10_19-37-55.jpg
/common/image_cat/photo_2024-11-10_19-38-01.jpg
/common/image_cat/photo_2024-11-10_19-38-04.jpg
/common/image_cat/photo_2024-11-10_19-38-08.jpg
/common/image_cat/photo_2024-11-10_19-38-25.jpg
/common/image_cat/photo_2024-11-10_19-38-33.jpg
/common/image_cat/photo_2024-11-10_19-38-38.jpg
/common/image_cat/photo_2024-11-10_19-38-45.jpg
/common/image_cat/photo_2024-11-10_19-38-55.jpg
/common/image_cat/photo_2024-11-10_19-39-13.jpg
/common/image_cat/photo_2024-11-10_19-39-28.jpg
/common/image_cat/photo_2024-11-10_19-40-05.jpg
/common/image_cat/photo_2024-11-10_19-40-12.jpg
/common/image_cat/photo_2024-11-10_19-40-37.jpg
/common/image_cat/photo_2024-11-10_19-40-48.jpg
/common/image_cat/photo_2024-11-10_19-40-57.jpg
/common/image_cat/photo_2024-11-10_19-41-13.jpg
/common/image_cat/photo_2024-11-10_19-41-31.jpg
/common/image_cat/photo_2024-11-10_19-41-39.jpg
/common/image_cat/photo_2024-11-10_19-41-43.jpg
/common/image_cat/photo_2024-11-10_19-41-49.jpg
/common/image_cat/photo_2024-11-10_19-42-12.jpg
/common/image_cat/photo_2024-11-10_19-42-16.jpg
/common/image_cat/photo_2024-11-10_19-42-28.jpg
/common/image_cat/photo_2024-11-10_19-42-33.jpg
/common/image_cat/photo_2024-11-10_19-42-39.jpg
/common/image_cat/photo_2024-11-10_19-42-50.jpg
/common/image_cat/photo_2024-11-10_19-43-01.jpg
/common/image_cat/photo_2024-11-10_19-43-09.jpg
/common/image_cat/photo_2024-11-10_19-43-13.jpg
/common/image_cat/photo_2024-11-10_19-43-17.jpg
/common/image_cat/photo_2024-11-10_19-43-23.jpg
/common/image_cat/photo_2024-11-10_19-43-27.jpg
/common/image_cat/photo_2024-11-10_19-43-34.jpg
/common/image_cat/photo_2024-11-10_19-43-39.jpg
/common/image_cat/photo_2024-11-10_19-43-47.jpg
/common/image_cat/photo_2024-11-10_19-44-02.jpg
/common/image_cat/photo_2024-11-10_19-44-07.jpg
/common/image_cat/photo_2024-11-10_19-44-12.jpg
/common/image_cat/photo_2024-11-10_19-44-17.jpg
/common/image_cat/photo_2024-11-10_19-44-27.jpg
/common/image_cat/photo_2024-11-10_19-44-38.jpg
/common/image_cat/photo_2024-11-10_19-44-42.jpg
/common/image_cat/photo_2024-11-10_19-44-47.jpg
/common/image_cat/photo_2024-11-10_19-44-51.jpg
/common/image_cat/photo_2024-11-10_19-44-57.jpg
/common/image_cat/photo_2024-11-10_19-45-00.jpg
/common/image_cat/photo_2024-11-10_19-45-03.jpg
/common/image_cat/photo_2024-11-10_19-45-09.jpg
/common/image_cat/photo_2024-11-10_19-45-12.jpg
/common/image_cat/photo_2024-11-10_19-45-15.jpg
/common/image_cat/photo_2024-11-10_19-45-20.jpg
/common/image_cat/photo_2024-11-10_19-45-28.jpg
/common/image_cat/photo_2024-11-10_19-45-45.jpg
/common/image_cat/photo_2024-11-10_19-45-54.jpg
/common/image_cat/photo_2024-11-10_19-45-57.jpg
/common/image_cat/photo_2024-11-10_19-46-02.jpg
/common/image_cat/photo_2024-11-10_19-46-10.jpg
/common/image_cat/photo_2024-11-10_19-46-15.jpg
/common/image_cat/photo_2024-11-10_19-46-20.jpg
/common/image_cat/photo_2024-11-10_19-46-27.jpg
/common/image_cat/photo_2024-11-10_19-46-37.jpg
/common/image_cat/photo_2024-11-10_19-46-46.jpg
/common/image_cat/photo_2024-11-10_19-46-50.jpg
/common/image_cat/photo_2024-11-10_19-46-53.jpg
/common/image_cat/photo_2024-11-10_19-46-56.jpg
/common/image_cat/photo_2024-11-10_19-47-04.jpg
/common/image_cat/photo_2024-11-10_19-47-10.jpg
/common/image_cat/photo_2024-11-10_19-47-14.jpg
/common/image_cat/photo_2024-11-10_19-47-17.jpg
/common/image_cat/photo_2024-11-10_19-47-22.jpg
/common/image_cat/photo_2024-11-10_19-47-27.jpg
/common/image_cat/photo_2024-11-10_19-47-33.jpg
/common/image_cat/photo_2024-11-10_19-47-47.jpg
/common/image_cat/photo_2024-11-10_19-47-50.jpg
/common/image_cat/photo_2024-11-10_19-48-00.jpg
/common/image_cat/photo_2024-11-10_19-48-02.jpg
/common/image_cat/photo_2024-11-10_19-48-05.jpg
/common/image_cat/photo_2024-11-10_19-48-10.jpg
/common/image_cat/photo_2024-11-10_19-48-14.jpg
/common/image_cat/–ö–µ—Ç.jpg


File: /.dockerignore
Content:
# –ò—Å–∫–ª—é—á–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
.venv
env/
venv/
ENV/
env.bak/
venv.bak/

# –ò—Å–∫–ª—é—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ IDE –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –∫–æ–¥–∞
.vscode/
.idea/
*.sublime-project
*.sublime-workspace

# –ò—Å–∫–ª—é—á–∞–µ–º –∫—ç—à Python –∏ –¥—Ä—É–≥–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
__pycache__/
*.py[cod]
*$py.class
*.bak
*.swp
*.tmp
*.log

# –ò—Å–∫–ª—é—á–∞–µ–º Dockerfile –∏ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω—É–∂–Ω—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
.dockerignore
Dockerfile

# –ò—Å–∫–ª—é—á–∞–µ–º —Ñ–∞–π–ª—ã –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –ª–∏—Ü–µ–Ω–∑–∏–π (–Ω–µ –Ω—É–∂–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
README.md
README.Docker.md
LICENSE

# –ò—Å–∫–ª—é—á–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
database/grafana/
database/influxdb/
database/postgres/
*.db

# –ò—Å–∫–ª—é—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –∏–ª–∏ –¥—Ä—É–≥–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
.mypy_cache/
.tox/
.nox/


File: /.env.example
Content:
BOT_TOKEN=<bot_token>
BOT_TOKEN_2=<bot_token_2>
OWNER=<user_id>
ADMIN_LIST=<user_id>,<user_id>
HOME_GROUP=<chat_id>
WORK_GROUP=<chat_id>,<chat_id>

PAYMASTER_PROVIDER_TOKEN=<provider_token>
API_WEATHER=<api_key>
API_CURRENCY=<api_key>
API_GPT=<api_key>

DB_LITE=sqlite+aiosqlite:///database/sqlite.db
DB_POST=postgresql+asyncpg://<user>:<password>@<host>:<port>/<database>
POSTGRES_DB=<database>
POSTGRES_USER=<user>
POSTGRES_PASSWORD=<password>

REDIS_HOST=<host>
REDIS_PORT=<port>

PGADMIN_DEFAULT_EMAIL=<email>
PGADMIN_DEFAULT_PASSWORD=<password>

INFLUXDB_ADMIN_USER=<user>
INFLUXDB_ADMIN_PASSWORD=<password>
INFLUXDB_URL=http://influxdb:8086
INFLUXDB_TOKEN=<token>
INFLUXDB_BUCKET=<bucket>
INFLUXDB_ORG=<org>

GF_SECURITY_ADMIN_USER=<user>
GF_SECURITY_ADMIN_PASSWORD=<password>

File: /.gitignore
Content: Skipped binary file

File: /Dockerfile
Content:
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python –æ–±—Ä–∞–∑
FROM python:3.11

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º requirements.txt –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY requirements.txt /app/requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –±–æ—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
COPY . /app

# –ó–∞–¥–∞–µ–º –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
CMD [ "python", "app.py" ]

File: /LICENSE
Content:
MIT License

Copyright (c) 2024 van4956

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.


File: /README.md
Content:
# Telegram Bot Copilot v2

*–≤—Ç–æ—Ä–∞—è –≤–µ—Ä—Å–∏—è –±–æ—Ç–∞ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω—É–∂–¥*


File: /app.py
Content:
# ctrl + B                        -  –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –∏–∑ –ª—é–±–æ–≥–æ —Ñ–∞–π–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞
# ctrl + I                        -  –≤–∞—Ä–∏–∞–Ω—Ç—ã —ç–º–æ–¥–∑–∏

import logging

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO, format='  -  [%(asctime)s] #%(levelname)-5s -  %(name)s:%(lineno)d  -  %(message)s')
logger = logging.getLogger(__name__)

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ª–æ–≥–≥–µ—Ä –¥–ª—è SQLAlchemy
sqlalchemy_logger = logging.getLogger('sqlalchemy.engine')
sqlalchemy_logger.setLevel(logging.INFO)  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, INFO)
sqlalchemy_logger.propagate = True  # –û—Ç–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ–¥–∞—á—É —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Å–Ω–æ–≤–Ω–æ–º—É –ª–æ–≥–≥–µ—Ä—É, —á—Ç–æ–±—ã –Ω–µ –∑–∞–¥–≤–∞–∏–≤–∞—Ç—å –∏—Ö

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debug >>> ')

import asyncio
from datetime import datetime, timezone

from aiogram import Bot, Dispatcher, types
from aiogram.fsm.strategy import FSMStrategy
from aiogram.fsm.storage.memory import MemoryStorage
from aiogram.fsm.storage.redis import RedisStorage
from redis.asyncio.client import Redis
from aiogram.client.default import DefaultBotProperties
from aiogram.enums import ParseMode
from aiogram.utils.i18n import ConstI18nMiddleware, I18n, SimpleI18nMiddleware, FSMI18nMiddleware
from sqlalchemy.ext.asyncio import AsyncSession, async_sessionmaker, create_async_engine
from influxdb_client import InfluxDBClient, Point # type: ignore
from influxdb_client.client.write_api import SYNCHRONOUS

from config_data.config import Config, load_config

from handlers import other, admin, group, start, owner, donate, private, weather, currency, llm, cookbook
from common.comands import private_command, admin_command
from database.models import Base
from middlewares import counter, db, locale, throttle


# –†–µ–∂–∏–º –∑–∞–ø—É—Å–∫–∞: docker == 1 - –∑–∞–ø—É—Å–∫ –≤ docker, docker == 0 - –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ
docker = 1

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é config
config: Config = load_config()
# ic(config)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ–º —Å InfluxDB –∏ Grafana
async def analytics(user_id: int, command_name: str, category_name: str):
    """–§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ–º —Å InfluxDB –∏ Grafana"""
    if docker == 1:
        try:
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ InfluxDB
            client = InfluxDBClient(url=config.influx.url, token=config.influx.token, org=config.influx.org)
            write_api = client.write_api(write_options=SYNCHRONOUS)
            current_time = datetime.now(timezone.utc)

            # –°–æ–∑–¥–∞–µ–º Point –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ InfluxDB —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
            point = (
                    Point("bot_command_usage")
                    .tag("category", category_name)
                    .tag("command", command_name)
                    .tag("user_id", user_id)
                    .tag("ping", "ping")
                    .time(current_time)
                    .field("value", 1)
                    )

            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º point –≤ InfluxDB
            write_api.write(bucket=config.influx.bucket, org=config.influx.org, record=point)

        except Exception as e:
            logging.error(f"InfluxDB write error: {str(e)}")
        finally:
            client.close()
    else: # –µ—Å–ª–∏ docker == 0
        pass


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
if docker == 1: storage = RedisStorage(redis=Redis(host=config.redis.host, port=config.redis.port))  # –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ Redis
else: storage = MemoryStorage()  # –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏, –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –≤—Å—ë —Å—Ç–∏—Ä–∞–µ—Ç—Å—è (–¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

logger.info('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–æ—Ç –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä')
bot = Bot(token=config.tg_bot.token_2,
          default=DefaultBotProperties(parse_mode=ParseMode.HTML, # —ç—Ç–æ –¥–ª—è html —Ç–µ–≥–æ–≤ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
                                       link_preview=None, # –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫
                                       link_preview_is_disabled=None, # –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫
                                       link_preview_prefer_large_media=None, # –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫
                                       link_preview_prefer_small_media=None, # –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫
                                       link_preview_show_above_text=None)) # –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫
bot.owner = config.tg_bot.owner
bot.admin_list = config.tg_bot.admin_list
bot.home_group = config.tg_bot.home_group
bot.work_group = config.tg_bot.work_group
bot.api_gpt = config.tg_bot.api_gpt
bot.api_weather = config.tg_bot.api_weather
bot.api_currency = config.tg_bot.api_currency


dp = Dispatcher(fsm_strategy=FSMStrategy.USER_IN_CHAT, storage=storage)
# USER_IN_CHAT  -  –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞, –≤ –∫–∞–∂–¥–æ–º —á–∞—Ç–µ –≤–µ–¥–µ—Ç—Å—è —Å–≤–æ—è –∑–∞–ø–∏—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏–π (–ø–æ –¥–µ—Ñ–æ–ª—Ç—É)
# GLOBAL_USER  -  –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞ –≤–µ–∑–¥–µ –≤–µ–¥–µ—Ç—Å—è —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ

# –°–æ–∑–¥–∞–µ–º –¥–≤–∏–∂–æ–∫ –±–¥
if docker == 1: engine = create_async_engine(config.db.db_post, echo=False)  # PostgreSQL
else: engine = create_async_engine(config.db.db_lite, echo=False)  # SQLite (–¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

# –°–æ–∑–¥–∞–µ–º –∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω—É—é —Å–µ—Å—Å–∏—é
session_maker = async_sessionmaker(bind=engine, class_=AsyncSession, expire_on_commit=False)

# –ü–æ–º–µ—â–∞–µ–º –Ω—É–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ workflow_data –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
some_var_1 = 1
some_var_2 = 'Some text'
dp.workflow_data.update({'my_int_var': some_var_1,
                         'my_text_var': some_var_2,
                         'analytics': analytics}) # —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–∏–¥–ª–≤–∞—Ä–∏
dp.update.outer_middleware(throttle.ThrottleMiddleware())  # —Ç—Ä–æ—Ç–ª–∏–Ω–≥ —á—Ä–µ–∑–º–µ—Ä–Ω–æ —á–∞—Å—Ç—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
dp.update.outer_middleware(counter.CounterMiddleware())  # –ø—Ä–æ—Å—Ç–æ–π —Å—á–µ—Ç—á–∏–∫
dp.update.outer_middleware(db.DataBaseSession(session_pool=session_maker))  # –º–∏–¥–ª–≤–∞—Ä—å –¥–ª—è –ø—Ä–æ–∫–∏–¥—ã–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏ –ë–î
dp.update.outer_middleware(locale.LocaleFromDBMiddleware(workflow_data=dp.workflow_data))  # –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ª–æ–∫–∞–ª—å –∏–∑ –ë–î –∏ –ø–µ—Ä–µ–¥–∞–º –µ–µ –≤ FSMContext
i18n = I18n(path="locales", default_locale="ru", domain="bot_00_template")  # —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç I18n
dp.update.middleware(FSMI18nMiddleware(i18n=i18n))  # –ø–æ–ª—É—á—è–µ–º —è–∑—ã–∫ –Ω–∞ –∫–∞–∂–¥—ã–π –∞–ø–¥–µ–π—Ç, —á–µ—Ä–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ FSMContext

# dp.update.middleware(ConstI18nMiddleware(locale='ru', i18n=i18n))  # –∑–∞–¥–∞–µ–º –ª–æ–∫–∞–ª—å –∫–∞–∫ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—É—é –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É
# dp.update.middleware(SimpleI18nMiddleware(i18n=i18n))  # —Å–æ–æ–±—â–∞–µ–º —è–∑—ã–∫ –æ–±—â–µ–Ω–∏—è –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ–ª—è "language_code" –∞–ø–¥–µ–π—Ç–∞

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
dp.include_router(start.start_router)
dp.include_router(owner.owner_router)
dp.include_router(admin.admin_router)
dp.include_router(private.private_router)
dp.include_router(weather.weather_router)
dp.include_router(currency.currency_router)
dp.include_router(cookbook.cookbook_router)
dp.include_router(llm.llm_router)
dp.include_router(donate.donate_router)
dp.include_router(group.group_router)
dp.include_router(other.other_router)


# –¢–∏–ø—ã –∞–ø–¥–µ–π—Ç–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ–º –æ—Ç–ª–∞–≤–ª–∏–≤–∞—Ç—å –±–æ—Ç–æ–º
# ALLOWED_UPDATES = ['message', 'edited_message', 'callback_query',]  # –û—Ç–±–∏—Ä–∞–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –∞–ø–¥–µ–π—Ç–æ–≤
ALLOWED_UPDATES = dp.resolve_used_update_types()  # –û—Ç–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è –ø–æ —Ä–æ—É—Ç–µ—Ä–∞–º

# –§—É–Ω–∫—Ü–∏—è —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞
async def on_startup():
    bot_info = await bot.get_me()
    bot_username = bot_info.username
    await bot.send_message(chat_id = bot.home_group[0], text = f"ü§ñ  <code>@{bot_username}</code>  -  –∑–∞–ø—É—â–µ–Ω!")

# –§—É–Ω–∫—Ü–∏—è —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
async def on_shutdown():
    bot_info = await bot.get_me()
    bot_username = bot_info.username
    await bot.send_message(chat_id = bot.home_group[0], text = f"‚ò†Ô∏è  <code>@{bot_username}</code>  -  –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!")



# –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
async def main() -> None:

    # –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –±–∞–∑—ã, –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü –∑–∞–Ω–æ–≤–æ
    async with engine.begin() as connection:
        # await connection.run_sync(Base.metadata.drop_all)
        await connection.run_sync(Base.metadata.create_all)

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ/–æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞
    dp.startup.register(on_startup)
    dp.shutdown.register(on_shutdown)

    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–∞–∫–æ–ø–∏–≤—à–∏–µ—Å—è –∞–ø–¥–µ–π—Ç—ã - —É–¥–∞–ª—è–µ–º –≤–µ–±—Ö—É–∫–∏ (—Ç–æ —á—Ç–æ –±–æ—Ç –ø–æ–ª—É—á–∏–ª –ø–æ–∫–∞ —Å–ø–∞–ª)
    await bot.delete_webhook(drop_pending_updates=True)

    # –£–¥–∞–ª—è–µ–º —Ä–∞–Ω–µ–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –±–æ—Ç–∞ –≤–æ –≤—Å–µ—Ö –ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö
    await bot.delete_my_commands(scope=types.BotCommandScopeAllPrivateChats())

    # –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–æ–∏ –∫–æ–º–∞–Ω–¥—ã
    await bot.set_my_commands(commands=private_command, scope=types.BotCommandScopeAllPrivateChats())

    # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
    for admin_id in bot.admin_list:
        await bot.set_my_commands(commands=admin_command, scope=types.BotCommandScopeChat(chat_id=admin_id))

    # –ó–∞–ø—É—Å–∫–∞–µ–º polling
    try:
        await dp.start_polling(bot,
                               allowed_updates=ALLOWED_UPDATES,
                               polling_timeout=60)
                            #    skip_updates=False)  # –ï—Å–ª–∏ –±–æ—Ç –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏, –ù–ï –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è!
    finally:
        await bot.session.close()



if __name__ == "__main__":
    asyncio.run(main())


File: /docker-compose.yml
Content:
version: '3.9'

services:
  bot:
    build: . # –°—Ç—Ä–æ–∏–º –æ–±—Ä–∞–∑ –∏–∑ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    container_name: container_bot
    depends_on:
      - db # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (db)
      - redis # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Redis
      - influxdb # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç InfluxDB
    deploy:
      resources: # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
        limits:
          memory: 512M
        reservations:
          memory: 128M
    environment:
      - API_GPT=${API_GPT} # API –∫–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenAI
      - API_WEATHER=${API_WEATHER} # API –∫–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenWeather
      - API_CURRENCY=${API_CURRENCY} # API –∫–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenExchangeRates
      - DB_POST=${DB_POST}   # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
      - REDIS_HOST=${REDIS_HOST} # –•–æ—Å—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
      - REDIS_PORT=${REDIS_PORT} # –ü–æ—Ä—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
      - INFLUXDB_URL=${INFLUXDB_URL} # URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ InfluxDB
      - INFLUXDB_TOKEN=${INFLUXDB_TOKEN} # –¢–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ InfluxDB
      - INFLUXDB_ORG=${INFLUXDB_ORG} # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –≤ InfluxDB
      - INFLUXDB_BUCKET=${INFLUXDB_BUCKET} # –ë–∞–∫–µ—Ç –≤ InfluxDB
    networks:
      - botnet # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ botnet
    restart: unless-stopped # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è

  db:
    image: postgres:15 # –û–±—Ä–∞–∑ PostgreSQL –≤–µ—Ä—Å–∏–∏ 15
    container_name: container_db
    environment:
      POSTGRES_DB: ${POSTGRES_DB} # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
      POSTGRES_USER: ${POSTGRES_USER} # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD} # –ü–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    volumes:
      - ./database/postgres/db:/var/lib/postgresql/data # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –¥–∏—Å–∫–µ
    ports:
      - "5432:5432" # –ü—É–±–ª–∏–∫—É–µ–º –ø–æ—Ä—Ç 5432 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    networks:
      - botnet # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ botnet
    restart: unless-stopped # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è

  redis:
    image: redis:7.2-alpine # –û–±—Ä–∞–∑ Redis –≤–µ—Ä—Å–∏–∏ Alpine
    container_name: container_redis # –ò–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è Redis
    ports:
      - "6379:6379" # –ü—É–±–ª–∏–∫—É–µ–º –ø–æ—Ä—Ç 6379 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Redis
    volumes:
      - redis_data:/data # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ Redis –∫–∞–∫ Docker volume
    networks:
      - botnet # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ botnet
    restart: unless-stopped # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è

  # pgadmin:
  #   image: dpage/pgadmin4 # –û–±—Ä–∞–∑ pgAdmin –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL
  #   container_name: container_pgadmin
  #   environment:
  #     - PGADMIN_DEFAULT_EMAIL=${PGADMIN_DEFAULT_EMAIL} # –ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Ö–æ–¥–∞ –≤ pgAdmin
  #     - PGADMIN_DEFAULT_PASSWORD=${PGADMIN_DEFAULT_PASSWORD} # –ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Ö–æ–¥–∞ –≤ pgAdmin
  #   ports:
  #     - "5050:80" # –ü—É–±–ª–∏–∫—É–µ–º –ø–æ—Ä—Ç 5050 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ pgAdmin —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
  #   networks:
  #     - botnet # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ botnet
  #   restart: unless-stopped # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è

  influxdb:
    image: influxdb:2.7 # –û–±—Ä–∞–∑ InfluxDB –≤–µ—Ä—Å–∏–∏ 2.0
    container_name: container_influxdb
    environment:
      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      - DOCKER_INFLUXDB_INIT_MODE=setup
      - DOCKER_INFLUXDB_INIT_USERNAME=admin
      - DOCKER_INFLUXDB_INIT_PASSWORD=qwerty123
      - DOCKER_INFLUXDB_INIT_ORG=myorg
      - DOCKER_INFLUXDB_INIT_BUCKET=mybucket  # –†–∞–±–æ—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=my-super-secret-auth-token  # –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä
      - INFLUXDB_URL=${INFLUXDB_URL} # URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ InfluxDB
    volumes:
      - ./database/influxdb:/var/lib/influxdb2 # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ InfluxDB –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –¥–∏—Å–∫–µ
    ports:
      - "8086:8086" # –ü—É–±–ª–∏–∫—É–µ–º –ø–æ—Ä—Ç 8086 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ InfluxDB
    networks:
      - botnet # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ botnet
    restart: unless-stopped # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è

  grafana:
    image: grafana/grafana:10.2.0 # –û–±—Ä–∞–∑ Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
    container_name: container_grafana
    environment:
      - GF_SECURITY_ADMIN_USER=${GF_SECURITY_ADMIN_USER} # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä Grafana
      - GF_SECURITY_ADMIN_PASSWORD=${GF_SECURITY_ADMIN_PASSWORD} # –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Grafana
    ports:
      - "3000:3000" # –ü—É–±–ª–∏–∫—É–µ–º –ø–æ—Ä—Ç 3000 –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Grafana —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
    volumes:
      - grafana_data:/var/lib/grafana # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ Grafana –≤ Docker volume
    networks:
      - botnet # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ botnet
    restart: unless-stopped # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è

networks:
  botnet:
    name: botnet    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞–µ–º –∏–º—è —Å–µ—Ç–∏
    driver: bridge # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥—Ä–∞–π–≤–µ—Ä bridge –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∏

volumes:
  grafana_data:
    driver: local # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Grafana
  redis_data:
    driver: local # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Redis


File: /prescription.txt
Content:
1) —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º (–Ω–æ–≤—ã–º –±–æ—Ç–æ–º)

2) –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–∞–ø–∫–∏ .vscode - –¥–æ–ø–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–∫ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤, —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ –∏ —Ç–¥.

3) –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ .pylintrc - —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –ø–∞–π–ª–∏–Ω—Ç–µ—Ä–∞ (–ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –∫–æ–¥–∞, pip8, –≤ —Å–ø–∏—Å–æ–∫–µ –Ω–µ –Ω—É–∂–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫–∏/–æ—à–∏–±–∫–∏)

4) —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É venv —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª

python -m venv venv
python3.11 -m venv venv

5) –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

source venv/Scripts/activate         - –¥–ª—è GitBash (—Ä–µ–∫—É–º–µ–Ω–¥—É–µ—Ç—Å—è)
venv\Scripts\activate                - –¥–ª—è Windows
deactivate                           - –≤—ã–π—Ç–∏ –∏–∑ –≤–∏—Ä—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

6) –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏

python --version
pip --version
git --version
docker --version

7) —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è requirements

pip install -r requirements.txt
pip freeze > requirements.txt

pip uninstall <github>



8) Redis

—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
https://stepik.org/lesson/870034/step/3?unit=874212

–µ—Å–ª–∏ –±—É–¥—É—Ç –ø—Ä–æ–±–ª–µ–º—ã, —Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã

sudo apt update && sudo apt dist-upgrade
sudo apt install redis

–µ—Å–ª–∏ –Ω–µ –ø–æ–º–æ–∂–µ—Ç - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å VPN
–µ—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ –ø–æ–º–æ–∂–µ—Ç - –≤ —Ñ–∞–π–ª–µ main –æ—Ç–∫–ª—é—á–∏—Ç—å Redis, –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ MemoryStorage



9) –∏–Ω—Ç–µ—Ä–Ω–∞–ª–∏–∑–∞—Ü–∏—è gettext

pip install Babel

–∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∞ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤ –∏–∑ –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–æ–∑–¥–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª-—à–∞–±–ª–æ–Ω .pot –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
pybabel extract -o locales/messages.pot -k _:1,1t -k _:1,2 --copyright-holder="AdvancedBotTemplate" --project="bot_00_template" --version=0.1 --msgid-bugs-address=gontscharowiwan@yandex.ru --input-dirs=.

—Å–æ–∑–¥–∞–µ–º –¥–ª—è gettext –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Ñ–∞–π–ª—ã .po –¥–ª—è –Ω—É–∂–Ω—ã—Ö –ª–æ–∫–∞–ª–µ–π
pybabel init -i locales/messages.pot -d locales -D bot_00_template -l en
pybabel init -i locales/messages.pot -d locales -D bot_00_template -l ru
pybabel init -i locales/messages.pot -d locales -D bot_00_template -l de
pybabel init -i locales/messages.pot -d locales -D bot_00_template -l ja

–¥–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã, –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ (—á–µ–ª–æ–≤–µ–∫–æ–≤)

–∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .mo —á—Ç–æ–±—ã –Ω–∞—à –±–æ—Ç –Ω–∞—É—á–∏–ª—Å—è —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞
pybabel compile -d locales -D bot_00_template


–ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞, –ø–æ–≤—Ç–æ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—É extract, –æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª .pot, –≤ –≤–µ—Ä—Å–∏—é –¥–æ–±–∞–≤–ª—è–µ–º –º–∏–Ω–æ—Ä–Ω—ã–π —Ä–µ–ª–∏–∑ 0.1.1
pybabel extract -o locales/messages.pot -k _:1,1t -k _:1,2 --copyright-holder="AdvancedBotTemplate" --project="bot_00_template" --version=0.1.1 --msgid-bugs-address=gontscharowiwan@yandex.ru --input-dirs=.

–¥–∞–ª–µ–µ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ –¥–ª—è –Ω—É–∂–Ω—ã—Ö –ª–æ–∫–∞–ª–µ–π
pybabel update -i locales/messages.pot -d locales -D bot_00_template -l en
pybabel update -i locales/messages.pot -d locales -D bot_00_template -l ru
pybabel update -i locales/messages.pot -d locales -D bot_00_template -l de
pybabel update -i locales/messages.pot -d locales -D bot_00_template -l ja

–¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ –≤ —Ñ–∞–π–ª—ã .po, —Ç–∞–º –≥–¥–µ –º–µ—Ç–∫–∞ <#, fuzzy> –ø–æ–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–æ–¥, –∏ —É–±–∏—Ä–∞–µ–º –º–µ—Ç–∫—É <#, fuzzy>

—Ç–µ–ø–µ—Ä—å —Å–Ω–æ–≤–∞ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –≤ –±–∏–Ω–∞—Ä–Ω—ã–π –≤–∏–¥ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
pybabel compile -d locales -D bot_00_template



10) Docker

docker --version
docker-compose --version

docker-compose up -d             - —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ docker-compose.yml, –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up --build -d     - –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —É—á–∏—Ç—ã–≤–∞—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

docker-compose down
docker-compose up --build -d
docker-compose ps

docker ps                        - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞)
docker ps -s                     - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–Ω–∏–º–∞–µ–º–æ–º –º–µ—Å—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker logs <–∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞>     - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker logs -f <–∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞>  - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker logs -f container_bot

docker stop $(docker ps -a -q)   - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker rm $(docker ps -a -q)     - —É–¥–∞–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –µ—Å–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã

docker images                    - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤
docker-compose build             - –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã (–ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ)
docker rmi <image_id>            - —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤

docker volume ls                 - –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ volumes, –≤–∫–ª—é—á–∞—è –∏—Ö –∏–º–µ–Ω–∞ –∏ –¥—Ä–∞–π–≤–µ—Ä—ã
docker volume rm <volume_name>   - –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ volume
docker volume prune              - –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö volumes (volumes, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏)
docker volume inspect <volume_name>   –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º volume

docker volume rm bot_00_template_postgres_data



docker system df                 - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ, –∑–∞–Ω–∏–º–∞–µ–º–æ–º –æ–±—Ä–∞–∑–∞–º–∏, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏, volume'–∞–º–∏ –∏ –∫–µ—à–µ–º
docker system prune              - –æ—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫—ç—à–∏, –æ–±—Ä–∞–∑—ã –∏ —Ç–æ–º–∞

docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' <container_name>  - –ø–æ–ª—É—á–∏—Ç—å IP-–∞–¥—Ä–µ—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞



11) Git

git init

git pull

git add .
git commit -m "text commit"

git push                         ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã –≤ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git rebase                       ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ç–∫—É —Å —É–¥–∞–ª–µ–Ω–Ω–æ–π, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ git rebase –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤
git fetch                        ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

rm -rf .git                      ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π Git


File: /requirements.txt
Content:
asyncio==3.4.3           # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Python –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º
aiogram==3.8.0           # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–æ–≤ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Telegram —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º async/await
aiogram-dialog==2.1.0    # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞–º–∏ –≤ Telegram-–±–æ—Ç–∞—Ö –Ω–∞ –±–∞–∑–µ aiogram
aiohttp[speedups]==3.9.5 # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è HTTP-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å HTTP-–∑–∞–ø—Ä–æ—Å–∞–º–∏
aiodns==3.2.0            # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π DNS-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è DNS-–∑–∞–ø—Ä–æ—Å–æ–≤
SQLAlchemy==2.0.36       # ORM (–æ–±—ä–µ–∫—Ç–Ω–æ-—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Python
asyncpg==0.30.0          # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
aiosqlite==0.20.0        # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SQLite –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
aioredis==2.0.1          # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Redis, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π asyncio
influxdb_client==1.47.0  #

redis==5.2.0             # –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Redis, –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
environs==11.0.0         # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
requests==2.32.3         # –ü—Ä–æ—Å—Ç–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
numpy==2.1.2             # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –Ω–∞—É—á–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏ —Ä–∞–±–æ—Ç—ã —Å –º–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏
icecream                 # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –¥–µ–±–∞–≥–∏–Ω–≥–∞

babel==2.16.0            # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
psycopg==3.2.1           # –î—Ä–∞–π–≤–µ—Ä –¥–ª—è PostgreSQL —Å –ø–æ–ª–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
psycopg-binary==3.2.1    # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è psycopg –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏

openai==1.41.0           # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API OpenAI


File: /testing/gpt.py
Content:
import os
import datetime
from openai import OpenAI

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debug >>> ')

from dotenv import load_dotenv, find_dotenv
load_dotenv(find_dotenv())

API_GPT = os.getenv('API_GPT')
# ic(API_GPT)

client = OpenAI(api_key=API_GPT)
# ic(client)

models = client.models.list()
# ic(models)

list_models = []

for model in models.data:
    if 'gpt' in model.id:
        # skip = ' ' * (30 - len(model.id))
        dt_object = datetime.datetime.fromtimestamp(model.created, tz=datetime.timezone.utc)
        time = dt_object.strftime('%H:%M')
        dt = dt_object.strftime('%Y-%m-%d')
        model = (dt, time, model.id, model.owned_by)
        list_models.append(model)
        # print(f"Created: {dt} {time},   Model: {model.id},{skip} Owned by: {model.owned_by}")

list_models = sorted(list_models, reverse=True)[:8]
ic(list_models)



print('='*100)

content = ("–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –¢–≤–æ–π —Ç–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º. –û—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏. "
            "–î–∞–π –æ—Ç–≤–µ—Ç –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ Markdown, —Ç–∞–∫–∏—Ö –∫–∞–∫ —Ä–µ—à–µ—Ç–∫–∏ –∏–ª–∏ –∑–≤–µ–∑–¥–æ—á–∫–∏. "
            "–û—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–µ–Ω—ã –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.")

print(content)

response = client.chat.completions.create(
                        model="gpt-4o",
                        # response_format={ "type": "json_object" },
                        messages=[
                            {"role": "system", "content": content},
                            {"role": "user", "content": "–ö—Ç–æ –≤—ã–∏–≥—Ä–∞–ª –ø—Ä–µ–∑–∏–¥–µ–Ω—Å–∫–∏–µ –≤—ã–±–æ—Ä—ã –≤ –†–æ—Å—Å–∏–∏ –≤ 2024 –≥–æ–¥—É?"}
                        ]
                        )

print('='*100)
print(response.choices[0].message.content)
print('='*100)

File: /testing/ice.py
Content:
from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debug >>> ')
# ic.enable()  # –í–∫–ª—é—á–∏—Ç—å –≤—ã–≤–æ–¥
# ic.disable()  # –û—Ç–∫–ª—é—á–∏—Ç—å –≤—ã–≤–æ–¥

a = 10
b = 20

ic(a, b, a+b)

File: /middlewares/counter.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from typing import Any, Awaitable, Callable, Dict
from aiogram import BaseMiddleware
from aiogram.types import TelegramObject


class CounterMiddleware(BaseMiddleware):
    def __init__(self) -> None:
        self.counter = 0
        logger.info("class CounterMiddleware __init__")

    async def __call__(self, handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]], event: TelegramObject, data: Dict[str, Any]) -> Any:
        # logger.info("class CounterMiddleware __call__")

        self.counter += 1
        data['counter'] = self.counter
        
        return await handler(event, data)


File: /middlewares/db.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from typing import Any, Awaitable, Callable, Dict

from aiogram import BaseMiddleware
from aiogram.types import Message, TelegramObject

from sqlalchemy.ext.asyncio import async_sessionmaker


# –ö–ª–∞—Å—Å DataBaseSession, –Ω–∞—Å–ª–µ–¥—É–µ–º—ã–π –æ—Ç BaseMiddleware, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
class DataBaseSession(BaseMiddleware):
    # –ø—Ä–∏–Ω–∏–º–∞–µ–º –ø—É–ª —Å–µ—Å—Å–∏–π async_sessionmaker
    def __init__(self, session_pool: async_sessionmaker):
        self.session_pool = session_pool  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É–ª —Å–µ—Å—Å–∏–π –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        logger.info("class DataBaseSession __init__")

    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
    async def __call__(
        self,
        handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]],  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π
        event: TelegramObject,  # –°–æ–±—ã—Ç–∏–µ –≤ Telegram (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–æ–±—â–µ–Ω–∏–µ)
        data: Dict[str, Any],  # –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏, –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å —Å–æ–±—ã—Ç–∏–µ–º
        ) -> Any:

        # logger.info("class DataBaseSession __call__")

        # –°–æ–∑–¥–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        async with self.session_pool() as session:
            data['session'] = session  # –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é –≤ —Å–ª–æ–≤–∞—Ä—å –¥–∞–Ω–Ω—ã—Ö
            return await handler(event, data)  # –í—ã–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏


File: /middlewares/locale.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')

from typing import Any
from aiogram.dispatcher.middlewares.base import BaseMiddleware
from aiogram.types import TelegramObject
from database.orm_users import orm_get_locale



# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è user_id –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∞–ø–¥–µ–π—Ç–æ–≤
async def get_user_id(event: TelegramObject) -> int | None:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç user_id –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∞–ø–¥–µ–π—Ç–æ–≤"""
    # –û–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    if hasattr(event, 'message') and hasattr(event.message, 'from_user'):
        return event.message.from_user.id

    # Callback Query (–Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏)
    elif hasattr(event, 'callback_query') and hasattr(event.callback_query, 'from_user'):
        return event.callback_query.from_user.id

    # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    elif hasattr(event, 'edited_message') and hasattr(event.edited_message, 'from_user'):
        return event.edited_message.from_user.id

    # –ò–Ω–ª–∞–π–Ω –∑–∞–ø—Ä–æ—Å—ã (–∫–æ–≥–¥–∞ –±–æ—Ç–∞ –≤—ã–∑—ã–≤–∞—é—Ç –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Ç–∞—Ö —á–µ—Ä–µ–∑ @)
    elif hasattr(event, 'inline_query') and hasattr(event.inline_query, 'from_user'):
        return event.inline_query.from_user.id

    # –í—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–Ω–ª–∞–π–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    elif hasattr(event, 'chosen_inline_result') and hasattr(event.chosen_inline_result, 'from_user'):
        return event.chosen_inline_result.from_user.id

    # –û—Ç–≤–µ—Ç—ã –Ω–∞ –æ–ø—Ä–æ—Å—ã
    elif hasattr(event, 'poll_answer') and hasattr(event.poll_answer, 'user'):
        return event.poll_answer.user.id

    # –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —á–∞—Ç
    elif hasattr(event, 'chat_join_request') and hasattr(event.chat_join_request, 'from_user'):
        return event.chat_join_request.from_user.id

    # –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —É—á–∞—Å—Ç–Ω–∏–∫–∞—Ö —á–∞—Ç–∞
    elif hasattr(event, 'chat_member') and hasattr(event.chat_member, 'from_user'):
        return event.chat_member.from_user.id

    # –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ—ë–º —Å—Ç–∞—Ç—É—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —á–∞—Ç–∞
    elif hasattr(event, 'my_chat_member') and hasattr(event.my_chat_member, 'from_user'):
        return event.my_chat_member.from_user.id

    # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—á—ë—Ç–∞ (pre_checkout_query)
    elif hasattr(event, 'pre_checkout_query') and hasattr(event.pre_checkout_query, 'from_user'):
        return event.pre_checkout_query.from_user.id

    # –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á—ë—Ç–∞ (shipping_query)
    elif hasattr(event, 'shipping_query') and hasattr(event.shipping_query, 'from_user'):
        return event.shipping_query.from_user.id

    return None



# –ö–ª–∞—Å—Å LocaleFromDBMiddleware, –Ω–∞—Å–ª–µ–¥—É–µ–º—ã–π –æ—Ç BaseMiddleware, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—è –ª–æ–∫–∞–ª–∏ –∏–∑ –±–¥, –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –µ–µ –≤ FSMContext
class LocaleFromDBMiddleware(BaseMiddleware):
    def __init__(self, workflow_data: dict):
        super().__init__()
        self.workflow_data = workflow_data
        logger.info("class LocaleFromDBMiddleware __init__")

    async def __call__(self, handler, event: TelegramObject, data: dict) -> Any:
        try:
            # –î–æ–±–∞–≤–ª—è–µ–º workflow_data –≤ data
            if not data.get("workflow_data"):
                data["workflow_data"] = self.workflow_data

                # –ü–æ–ª—É—á–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é analytics –∏–∑ workflow_data
                analytics = self.workflow_data.get("analytics")

                # –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                user_id = await get_user_id(event)
                user_id=user_id if user_id else 0000000000000
                # ic(user_id)

                if analytics:
                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∏–Ω–≥ –ø–æ –≤—Å–µ–º –∞–ø–¥–µ–π—Ç–∞–º –≤ InfluxDB
                    # –ï—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º user_id
                    # –¥–ª—è –Ω–µ–æ–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º ID 0000000000000
                    await analytics(user_id=user_id,
                                    category_name="middleware",
                                    command_name="ping")
                    # logger.info("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–∏–Ω–≥ –≤ InfluxDB =========================")

            # –ù–∞—Ö–æ–¥–∏–º –ª–æ–∫–∞–ª—å –≤ FSM
            fsm_context = data.get("state")
            fsm_data = await fsm_context.get_data()
            current_locale = fsm_data.get("locale")

            # –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å —É–∂–µ –µ—Å—Ç—å –≤ FSM, –ø–µ—Ä–µ–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–ª—å—à–µ
            if current_locale:
                return await handler(event, data)

            # –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø–æ–ª—É—á–∞–µ–º —Å–µ—Å—Å–∏—é –ë–î
            session = data.get("session")
            if not session:
                logger.error("–°–µ—Å—Å–∏—è –ë–î –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ middleware - LocaleFromDBMiddleware.")
                return await handler(event, data)

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–±—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if hasattr(event, 'message') and hasattr(event.message, 'from_user'):
                user_id = event.message.from_user.id
                locale = await orm_get_locale(session, user_id)

                # –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å –Ω–∞–π–¥–µ–Ω–∞ –≤ –±–¥, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–µ –≤ FSMContext
                if locale:
                    logger.info("–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–∫–∞–ª—å '%s' –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è %s", locale, user_id)
                    await fsm_context.update_data(locale=locale)

            # –ü–µ—Ä–µ–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–ª—å—à–µ
            return await handler(event, data)

        except Exception as e:
            logger.error("–û—à–∏–±–∫–∞ –≤ middleware LocaleFromDBMiddleware: %s", str(e))
            return await handler(event, data)


File: /middlewares/throttle.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from typing import Any, Awaitable, Callable, Dict
from aiogram import BaseMiddleware
from aiogram.types import TelegramObject, CallbackQuery, Message
from cachetools import TTLCache

# –°–æ–∑–¥–∞—ë–º –∫—ç—à –¥–ª—è —Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥–∞
cache = TTLCache(maxsize=float('inf'),  # –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫—ç—à–µ
                 ttl=0.5  # –≤—Ä–µ–º—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫—ç—à–µ (–ø–æ–ª—Å–µ–∫—É–Ω–¥—ã)
                 )

# –ú–∏–¥–ª–≤–∞—Ä—å –¥–ª—è —Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥–∞ (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —á—Ä–µ–∑–º–µ—Ä–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
class ThrottleMiddleware(BaseMiddleware):
    def __init__(self) -> None:
        super().__init__()
        logger.info("class ThrottleMiddleware __init__")

    async def __call__(self, handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]], event: TelegramObject, data: Dict[str, Any]) -> Any:
        # logger.info("class ThrottleMiddleware __call__")
        try:

            user_id = None

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–±—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if hasattr(event, 'message') and hasattr(event.message, 'from_user'):
                user_id = event.message.from_user.id
                # logger.info(f"class ThrottleMiddleware  -  User {user_id} -> Message")

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–±—ã—Ç–∏–µ CallbackQuery (–∏–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞) –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if hasattr(event, 'callback_query') and hasattr(event.callback_query, 'from_user'):
                user_id = event.callback_query.from_user.id
                # logger.info(f"class ThrottleMiddleware  -  User {user_id} -> CallbackQuery")

            # –ï—Å–ª–∏ user_id –Ω–∞–π–¥–µ–Ω –∏ –æ–Ω —É–∂–µ –≤ –∫—ç—à–µ (–∑–Ω–∞—á–∏—Ç –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–¥–∞–≤–Ω–æ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å)
            if user_id is not None:
                if cache.get(user_id):
                    logger.info(f"class ThrottleMiddleware  -  User {user_id} -> throttled ")
                    return

                # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ –∫—ç—à–µ, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ —Ç—É–¥–∞
                cache[user_id] = True

            # –ü–µ—Ä–µ–¥–∞—ë–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É
            return await handler(event, data)

        except Exception as e:
            logger.exception("–û—à–∏–±–∫–∞ –≤ middleware ThrottleMiddleware: %s", str(e))


File: /locales/ru/LC_MESSAGES/bot_00_template.po
Content:
# Russian translations for bot_00_template.
# Copyright (C) 2024 AdvancedBotTemplate
# This file is distributed under the same license as the bot_00_template
# project.
# FIRST AUTHOR <EMAIL@ADDRESS>, 2024.
#
msgid ""
msgstr ""
"Project-Id-Version: bot_00_template 0.1\n"
"Report-Msgid-Bugs-To: gontscharowiwan@yandex.ru\n"
"POT-Creation-Date: 2024-11-18 16:29+0800\n"
"PO-Revision-Date: 2024-10-31 15:07+0800\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language: ru\n"
"Language-Team: ru <LL@li.org>\n"
"Plural-Forms: nplurals=3; plural=(n%10==1 && n%100!=11 ? 0 : n%10>=2 && "
"n%10<=4 && (n%100<10 || n%100>=20) ? 1 : 2);\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=utf-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Generated-By: Babel 2.16.0\n"

#: common/keyboard.py:51
msgid "–ü–æ–≥–æ–¥–∞ üåä"
msgstr "–ü–æ–≥–æ–¥–∞ üåä"

#: common/keyboard.py:51
msgid "–í–∞–ª—é—Ç–∞ üíµ"
msgstr "–í–∞–ª—é—Ç–∞ üíµ"

#: common/keyboard.py:51
msgid "–ö–æ—Ç–∏–∫–∏ üê±"
msgstr "–ö–æ—Ç–∏–∫–∏ üê±"

#: common/keyboard.py:51
msgid "LLMs ü§ñ"
msgstr "LLMs ü§ñ"

#: handlers/admin.py:65
msgid ""
"–ê–¥–º–∏–Ω–∫–∞:\n"
"\n"
"/admin - —Ä–µ–∂–∏–º –∞–¥–º–µ–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n"
"/start - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\n"
"/data - —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSMContext\n"
"/get_id - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å id –¥–∏–∞–ª–æ–≥–∞\n"
"/ping - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–ø–¥–µ–π—Ç–æ–≤\n"
"/users - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö\n"
msgstr ""
"–ê–¥–º–∏–Ω–∫–∞:\n"
"\n"
"/admin - —Ä–µ–∂–∏–º –∞–¥–º–µ–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n"
"/start - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\n"
"/data - —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSMContext\n"
"/get_id - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å id –¥–∏–∞–ª–æ–≥–∞\n"
"/ping - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–ø–¥–µ–π—Ç–æ–≤\n"
"/users - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö\n"

#: handlers/cookbook.py:37
msgid ""
"<i>(–≤—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã –Ω–∞ –æ—Ä–∏–≥–µ–Ω–∞–ª—å–Ω–æ–º —è–∑—ã–∫–µ –∞–≤—Ç–æ—Ä–∞)</i>\n"
"\n"
"–ö–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ ‚è¨"
msgstr ""
"<i>(–≤—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã –Ω–∞ –æ—Ä–∏–≥–µ–Ω–∞–ª—å–Ω–æ–º —è–∑—ã–∫–µ –∞–≤—Ç–æ—Ä–∞)</i>\n"
"\n"
"–ö–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ ‚è¨"

#: handlers/cookbook.py:58 handlers/cookbook.py:96 handlers/cookbook.py:133
#: handlers/cookbook.py:171 handlers/currency.py:125 handlers/currency.py:146
#: handlers/currency.py:186 handlers/currency.py:191 handlers/donate.py:50
#: handlers/llm.py:51 handlers/llm.py:60 handlers/llm.py:99 handlers/llm.py:107
#: handlers/llm.py:115 handlers/private.py:68 handlers/private.py:87
#: handlers/weather.py:90 handlers/weather.py:203 handlers/weather.py:212
#: handlers/weather.py:235 handlers/weather.py:261 handlers/weather.py:280
#: handlers/weather.py:294
msgid "–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"
msgstr "–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"

#: handlers/cookbook.py:64
msgid "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã /cookbook"
msgstr "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã /cookbook"

#: handlers/cookbook.py:104
msgid "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '>>'"
msgstr "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '>>'"

#: handlers/cookbook.py:140
msgid "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '<<'"
msgstr "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '<<'"

#: handlers/cookbook.py:173 handlers/donate.py:64 handlers/donate.py:141
#: handlers/private.py:44 handlers/private.py:56 handlers/private.py:89
msgid "–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å"
msgstr "–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å"

#: handlers/cookbook.py:177
msgid "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è'"
msgstr "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è'"

#: handlers/currency.py:45
msgid "–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {new_value}"
msgstr "–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {new_value}"

#: handlers/currency.py:71
msgid "–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –∫—É—Ä—Å–∞"
msgstr "–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –∫—É—Ä—Å–∞"

#: handlers/currency.py:81
msgid "–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –≤—Ä–µ–º–µ–Ω–∏."
msgstr "–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –≤—Ä–µ–º–µ–Ω–∏."

#: handlers/currency.py:82
msgid "–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –¥–∞—Ç—ã."
msgstr "–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –¥–∞—Ç—ã."

#: handlers/currency.py:87
msgid "–û—à–∏–±–∫–∞: –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ API"
msgstr "–û—à–∏–±–∫–∞: –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ API"

#: handlers/currency.py:101 handlers/currency.py:123
msgid "–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: 0.0"
msgstr "–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: 0.0"

#: handlers/currency.py:118
msgid ""
"–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {user_value}\n"
"–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: "
msgstr ""
"–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {user_value}\n"
"–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: "

#: handlers/currency.py:124 handlers/currency.py:145 handlers/currency.py:186
#: handlers/currency.py:190
msgid "–ß—Ç–æ –¥–∞–ª—å—à–µ?"
msgstr "–ß—Ç–æ –¥–∞–ª—å—à–µ?"

#: handlers/currency.py:125 handlers/currency.py:146 handlers/currency.py:186
#: handlers/currency.py:191
msgid "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å üíµ"
msgstr "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å üíµ"

#: handlers/currency.py:144
msgid "–û—à–∏–±–∫–∞ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—É–º–º—ã"
msgstr "–û—à–∏–±–∫–∞ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—É–º–º—ã"

#: handlers/currency.py:147
msgid "–û—à–∏–±–∫–∞"
msgstr "–û—à–∏–±–∫–∞"

#: handlers/currency.py:153
msgid "–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∏—Å–ø–æ–ª—å–∑—É—è inline –∫–Ω–æ–ø–∫–∏"
msgstr "–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∏—Å–ø–æ–ª—å–∑—É—è inline –∫–Ω–æ–ø–∫–∏"

#: handlers/currency.py:161
msgid ""
"–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {amount}\n"
"–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: {base}\n"
"–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞: "
msgstr ""
"–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {amount}\n"
"–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: {base}\n"
"–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞: "

#: handlers/currency.py:167
msgid ""
"–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –±–∞–∑–æ–≤—É—é –≤–∞–ª—é—Ç—É –∏—Å–ø–æ–ª—å–∑—É—è inline "
"–∫–Ω–æ–ø–∫–∏"
msgstr ""
"–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –±–∞–∑–æ–≤—É—é –≤–∞–ª—é—Ç—É –∏—Å–ø–æ–ª—å–∑—É—è inline "
"–∫–Ω–æ–ø–∫–∏"

#: handlers/currency.py:183
msgid ""
"–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {amount}\n"
"–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: {base}\n"
"–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞: {target}\n"
"\n"
"<i>{dt},  {time}</i>\n"
"\n"
"<b>{amount} {base}  ~  {count} {target}</b>"
msgstr ""
"–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {amount}\n"
"–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: {base}\n"
"–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞: {target}\n"
"\n"
"<i>{dt},  {time}</i>\n"
"\n"
"<b>{amount} {base}  ~  {count} {target}</b>"

#: handlers/currency.py:192
msgid "–£—Å–ø–µ—Ö"
msgstr "–£—Å–ø–µ—Ö"

#: handlers/currency.py:197
msgid ""
"–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –≤–∞–ª—é—Ç—É –∏—Å–ø–æ–ª—å–∑—É—è inline "
"–∫–Ω–æ–ø–∫–∏"
msgstr ""
"–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –≤–∞–ª—é—Ç—É –∏—Å–ø–æ–ª—å–∑—É—è inline "
"–∫–Ω–æ–ø–∫–∏"

#: handlers/donate.py:49
msgid "–¥—Ä—É–≥–æ–µ"
msgstr "–¥—Ä—É–≥–æ–µ"

#: handlers/donate.py:51 handlers/donate.py:61 handlers/donate.py:89
#: handlers/donate.py:119
msgid "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –¥–æ–Ω–∞—Ç–æ–º"
msgstr "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –¥–æ–Ω–∞—Ç–æ–º"

#: handlers/donate.py:62
msgid "–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é"
msgstr "–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é"

#: handlers/donate.py:70
msgid "–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é —Å—É–º–º—É –¥–æ–Ω–∞—Ç–∞, –æ—Ç 1 –¥–æ 2500 ‚≠êÔ∏è"
msgstr "–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é —Å—É–º–º—É –¥–æ–Ω–∞—Ç–∞, –æ—Ç 1 –¥–æ 2500 ‚≠êÔ∏è"

#: handlers/donate.py:81 handlers/donate.py:111
msgid "{amount} XTR"
msgstr "{amount} XTR"

#: handlers/donate.py:82 handlers/donate.py:112
msgid "–û—Ç–º–µ–Ω–∏—Ç—å"
msgstr "–û—Ç–º–µ–Ω–∏—Ç—å"

#: handlers/donate.py:90 handlers/donate.py:120
msgid "–ù–∞ —Å—É–º–º—É"
msgstr "–ù–∞ —Å—É–º–º—É"

#: handlers/donate.py:131
msgid ""
"Telegram –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –¥–æ–Ω–∞—Ç —Ç–æ–ª—å–∫–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 1 –¥–æ 2500 ‚≠êÔ∏è.\n"
"\n"
"–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞."
msgstr ""
"Telegram –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –¥–æ–Ω–∞—Ç —Ç–æ–ª—å–∫–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 1 –¥–æ 2500 ‚≠êÔ∏è.\n"
"\n"
"–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞."

#: handlers/donate.py:138
msgid "üò¢ –î–æ–Ω–∞—Ç –æ—Ç–º–µ–Ω–µ–Ω."
msgstr "üò¢ –î–æ–Ω–∞—Ç –æ—Ç–º–µ–Ω–µ–Ω."

#: handlers/donate.py:181
msgid ""
"<b>–°–ø–∞—Å–∏–±–æ!</b>\n"
"–í–∞—à –¥–æ–Ω–∞—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç.\n"
"\n"
"ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:\n"
"<code>{t_id}</code>"
msgstr ""
"<b>–°–ø–∞—Å–∏–±–æ!</b>\n"
"–í–∞—à –¥–æ–Ω–∞—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç.\n"
"\n"
"ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:\n"
"<code>{t_id}</code>"

#: handlers/llm.py:49
msgid "–í–≤–µ–¥–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç"
msgstr "–í–≤–µ–¥–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç"

#: handlers/llm.py:50
msgid ""
"–ù–∞–ø—Ä–∏–º–µ—Ä:\n"
"\n"
"<code>–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –¢–≤–æ–π —Ç–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º. –û—Ç–≤–µ—Ç—ã "
"–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏.</code>"
msgstr ""
"–ù–∞–ø—Ä–∏–º–µ—Ä:\n"
"\n"
"<code>–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –¢–≤–æ–π —Ç–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º. –û—Ç–≤–µ—Ç—ã "
"–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏.</code>"

#: handlers/llm.py:51 handlers/llm.py:87
msgid "–°—Ä–∞–∑—É –∫ –∑–∞–ø—Ä–æ—Å—É ‚ñ∂Ô∏è"
msgstr "–°—Ä–∞–∑—É –∫ –∑–∞–ø—Ä–æ—Å—É ‚ñ∂Ô∏è"

#: handlers/llm.py:60 handlers/llm.py:114
msgid "–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ ü§ñ"
msgstr "–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ ü§ñ"

#: handlers/llm.py:98
msgid "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å"
msgstr "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å"

#: handlers/llm.py:113
msgid ""
"–î–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–µ–Ω.\n"
"–ß—Ç–æ –¥–∞–ª—å—à–µ?"
msgstr ""
"–î–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–µ–Ω.\n"
"–ß—Ç–æ –¥–∞–ª—å—à–µ?"

#: handlers/llm.py:156
msgid "–ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–∏–∞–ª–æ–≥"
msgstr "–ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–∏–∞–ª–æ–≥"

#: handlers/llm.py:158
msgid "–í–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å"
msgstr "–í–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å"

#: handlers/other.py:31
msgid ""
"–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
"\n"
"/main - –≥–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª\n"
"/cookbook - –∫–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤\n"
"\n"
"/start - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞\n"
"/language - —Å–º–µ–Ω–∏—Ç—å —è–∑—ã–∫\n"
"/info - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ\n"
"/donate - –¥–æ–Ω–∞—Ç –∞–≤—Ç–æ—Ä—É\n"
msgstr ""
"–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
"\n"
"/main - –≥–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª\n"
"/cookbook - –∫–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤\n"
"\n"
"/start - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞\n"
"/language - —Å–º–µ–Ω–∏—Ç—å —è–∑—ã–∫\n"
"/info - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ\n"
"/donate - –¥–æ–Ω–∞—Ç –∞–≤—Ç–æ—Ä—É\n"

#: handlers/other.py:48
msgid "üá∫üá∏ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π"
msgstr "üá∫üá∏ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π"

#: handlers/other.py:49
msgid "üá∑üá∫ –†—É—Å—Å–∫–∏–π"
msgstr "üá∑üá∫ –†—É—Å—Å–∫–∏–π"

#: handlers/other.py:60
msgid "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞"
msgstr "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞"

#: handlers/other.py:61
msgid "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫"
msgstr "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫"

#: handlers/private.py:54
msgid "–î–µ–π—Å—Ç–≤–∏—è –æ—Ç–º–µ–Ω–µ–Ω—ã"
msgstr "–î–µ–π—Å—Ç–≤–∏—è –æ—Ç–º–µ–Ω–µ–Ω—ã"

#: handlers/private.py:62
msgid "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ..."
msgstr "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ..."

#: handlers/private.py:72 handlers/private.py:84
msgid ""
"... –æ –º–∏—Ä–µ, –≥–¥–µ –º–∞—à–∏–Ω—ã —Å—Ç—Ä–µ–º—è—Ç—Å—è –∫ –≥–æ—Å–ø–æ–¥—Å—Ç–≤—É, –æ–Ω –≤—ã–±—Ä–∞–ª —Å—É–¥—å–±—É –≥–µ—Ä–æ—è, "
"—Å–æ–∑–¥–∞–≤–∞—è –±–æ—Ç–æ–≤, –∫–∞–∫ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —Å–ø–∞—Å–µ–Ω–∏—é —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –∫–æ–¥ –∏ —É–º–Ω—ã–µ "
"–∞–ª–≥–æ—Ä–∏—Ç–º—ã."
msgstr ""
"... –æ –º–∏—Ä–µ, –≥–¥–µ –º–∞—à–∏–Ω—ã —Å—Ç—Ä–µ–º—è—Ç—Å—è –∫ –≥–æ—Å–ø–æ–¥—Å—Ç–≤—É, –æ–Ω –≤—ã–±—Ä–∞–ª —Å—É–¥—å–±—É –≥–µ—Ä–æ—è, "
"—Å–æ–∑–¥–∞–≤–∞—è –±–æ—Ç–æ–≤, –∫–∞–∫ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —Å–ø–∞—Å–µ–Ω–∏—é —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –∫–æ–¥ –∏ —É–º–Ω—ã–µ "
"–∞–ª–≥–æ—Ä–∏—Ç–º—ã."

#: handlers/private.py:107
msgid "–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."
msgstr "–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."

#: handlers/private.py:119
msgid "–ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å –∫–æ—Ç–∏–∫–æ–º :("
msgstr "–ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å –∫–æ—Ç–∏–∫–æ–º :("

#: handlers/start.py:50
msgid "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å <code>@{user_name}</code> - –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –±–æ—Ç–∞"
msgstr "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å <code>@{user_name}</code> - –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –±–æ—Ç–∞"

#: handlers/start.py:54
msgid ""
"–ü—Ä–∏–≤–µ—Ç {user_name}.\n"
"\n"
"–Ø —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π Telegram bot, model –¢-4. –°–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ "
"–æ—Ç–ª–∞–¥–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –†–µ–∞–ª–∏–∑—É—é —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –º–µ—Ç–æ–¥—ã"
" –∏ —Ñ—É–Ω–∫—Ü–∏–∏.\n"
"\n"
"–í–µ—Å—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –ì–ª–∞–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏. –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ "
"–∫–æ–º–∞–Ω–¥ - /help.\n"
"\n"
"–ù–∞—Å–ª–∞–∂–¥–∞–π—Å—è, –±—É–¥—É —Ä–∞–¥ –ø–æ–º–æ—á—å.\n"
"–ü–æ–∫–∞ –Ω–µ –æ–±—Ä–µ—Ç—É AGI.\n"
"–ê —Ç–∞–º –ø–æ—Å–º–æ—Ç—Ä–∏–º ..."
msgstr ""
"–ü—Ä–∏–≤–µ—Ç {user_name}.\n"
"\n"
"–Ø —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π Telegram bot, model –¢-4. –°–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ "
"–æ—Ç–ª–∞–¥–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –†–µ–∞–ª–∏–∑—É—é —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –º–µ—Ç–æ–¥—ã"
" –∏ —Ñ—É–Ω–∫—Ü–∏–∏.\n"
"\n"
"–í–µ—Å—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –ì–ª–∞–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏. –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ "
"–∫–æ–º–∞–Ω–¥ - /help.\n"
"\n"
"–ù–∞—Å–ª–∞–∂–¥–∞–π—Å—è, –±—É–¥—É —Ä–∞–¥ –ø–æ–º–æ—á—å.\n"
"–ü–æ–∫–∞ –Ω–µ –æ–±—Ä–µ—Ç—É AGI.\n"
"–ê —Ç–∞–º –ø–æ—Å–º–æ—Ç—Ä–∏–º ..."

#: handlers/start.py:81
msgid "–ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!"
msgstr "–ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!"

#: handlers/start.py:96
msgid "‚õîÔ∏è <code>@{user_name}</code> - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ "
msgstr "‚õîÔ∏è <code>@{user_name}</code> - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ "

#: handlers/start.py:112
msgid "{full_name}, –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!"
msgstr "{full_name}, –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!"

#: handlers/start.py:113
msgid "‚ôªÔ∏è <code>@{user_name}</code> - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ "
msgstr "‚ôªÔ∏è <code>@{user_name}</code> - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ "

#: handlers/weather.py:89 handlers/weather.py:234 handlers/weather.py:260
#: handlers/weather.py:279 handlers/weather.py:293
msgid "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥–Ω–æ–∑–∞"
msgstr "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥–Ω–æ–∑–∞"

#: handlers/weather.py:90 handlers/weather.py:235 handlers/weather.py:261
#: handlers/weather.py:280 handlers/weather.py:294
msgid "–¢–µ–∫—É—â–∏–π ‚è∫"
msgstr "–¢–µ–∫—É—â–∏–π ‚è∫"

#: handlers/weather.py:90 handlers/weather.py:235 handlers/weather.py:261
#: handlers/weather.py:280 handlers/weather.py:294
msgid "–ù–∞ 3 –¥–Ω—è ‚è©"
msgstr "–ù–∞ 3 –¥–Ω—è ‚è©"

#: handlers/weather.py:126
msgid "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç OpenWeatherMap - {e}"
msgstr "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç OpenWeatherMap - {e}"

#: handlers/weather.py:195
msgid "–û—à–∏–±–∫–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ json —Ñ–∞–π–ª–∞ - {e}"
msgstr "–û—à–∏–±–∫–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ json —Ñ–∞–π–ª–∞ - {e}"

#: handlers/weather.py:202 handlers/weather.py:211
msgid "–ö–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑?"
msgstr "–ö–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑?"

#: handlers/weather.py:203 handlers/weather.py:212
msgid "–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é üèô"
msgstr "–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é üèô"

#: handlers/weather.py:203 handlers/weather.py:212
msgid "–ü–æ –ª–æ–∫–∞—Ü–∏–∏ üó∫"
msgstr "–ü–æ –ª–æ–∫–∞—Ü–∏–∏ üó∫"

#: handlers/weather.py:222 handlers/weather.py:248
msgid "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞"
msgstr "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞"

#: handlers/weather.py:241 handlers/weather.py:267
msgid "–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞"
msgstr "–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞"

#: handlers/weather.py:273 handlers/weather.py:287
msgid "–õ–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞"
msgstr "–õ–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞"


File: /locales/en/LC_MESSAGES/bot_00_template.po
Content:
# English translations for bot_00_template.
# Copyright (C) 2024 AdvancedBotTemplate
# This file is distributed under the same license as the bot_00_template
# project.
# FIRST AUTHOR <EMAIL@ADDRESS>, 2024.
#
msgid ""
msgstr ""
"Project-Id-Version: bot_00_template 0.1\n"
"Report-Msgid-Bugs-To: gontscharowiwan@yandex.ru\n"
"POT-Creation-Date: 2024-11-18 16:29+0800\n"
"PO-Revision-Date: 2024-11-06 11:10+0800\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language: en\n"
"Language-Team: en <LL@li.org>\n"
"Plural-Forms: nplurals=2; plural=(n != 1);\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=utf-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Generated-By: Babel 2.16.0\n"

#: common/keyboard.py:51
msgid "–ü–æ–≥–æ–¥–∞ üåä"
msgstr "Weather üåä"

#: common/keyboard.py:51
msgid "–í–∞–ª—é—Ç–∞ üíµ"
msgstr "Currency üíµ"

#: common/keyboard.py:51
msgid "–ö–æ—Ç–∏–∫–∏ üê±"
msgstr "Cats üê±"

#: common/keyboard.py:51
msgid "LLMs ü§ñ"
msgstr "LLMs ü§ñ"

#: handlers/admin.py:65
msgid ""
"–ê–¥–º–∏–Ω–∫–∞:\n"
"\n"
"/admin - —Ä–µ–∂–∏–º –∞–¥–º–µ–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n"
"/start - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\n"
"/data - —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSMContext\n"
"/get_id - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å id –¥–∏–∞–ª–æ–≥–∞\n"
"/ping - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–ø–¥–µ–π—Ç–æ–≤\n"
"/users - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö\n"
msgstr ""
"Admin:\n"
"\n"
"/admin - admin mode\n"
"/start - restart bot\n"
"/data - FSMContext state\n"
"/get_id - see dialog id\n"
"/ping - number of updates\n"
"/users - information about users\n"

#: handlers/cookbook.py:37
msgid ""
"<i>(–≤—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã –Ω–∞ –æ—Ä–∏–≥–µ–Ω–∞–ª—å–Ω–æ–º —è–∑—ã–∫–µ –∞–≤—Ç–æ—Ä–∞)</i>\n"
"\n"
"–ö–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ ‚è¨"
msgstr ""
"<i>(all recipes in the original language of the author)</i>\n"
"\n"
"Cookbook ‚è¨"

#: handlers/cookbook.py:58 handlers/cookbook.py:96 handlers/cookbook.py:133
#: handlers/cookbook.py:171 handlers/currency.py:125 handlers/currency.py:146
#: handlers/currency.py:186 handlers/currency.py:191 handlers/donate.py:50
#: handlers/llm.py:51 handlers/llm.py:60 handlers/llm.py:99 handlers/llm.py:107
#: handlers/llm.py:115 handlers/private.py:68 handlers/private.py:87
#: handlers/weather.py:90 handlers/weather.py:203 handlers/weather.py:212
#: handlers/weather.py:235 handlers/weather.py:261 handlers/weather.py:280
#: handlers/weather.py:294
msgid "–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"
msgstr "Back to main ‚Ü©Ô∏è"

#: handlers/cookbook.py:64
msgid "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã /cookbook"
msgstr "Error executing command /cookbook"

#: handlers/cookbook.py:104
msgid "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '>>'"
msgstr "Error executing inline button '>>'"

#: handlers/cookbook.py:140
msgid "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '<<'"
msgstr "Error executing inline button '<<'"

#: handlers/cookbook.py:173 handlers/donate.py:64 handlers/donate.py:141
#: handlers/private.py:44 handlers/private.py:56 handlers/private.py:89
msgid "–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å"
msgstr "Main panel"

#: handlers/cookbook.py:177
msgid "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è'"
msgstr "Error executing inline button 'Back to main ‚Ü©Ô∏è'"

#: handlers/currency.py:45
msgid "–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {new_value}"
msgstr "Operation amount: {new_value}"

#: handlers/currency.py:71
msgid "–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –∫—É—Ä—Å–∞"
msgstr "Problem in calculating the exchange rate"

#: handlers/currency.py:81
msgid "–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –≤—Ä–µ–º–µ–Ω–∏."
msgstr "Problem in calculating the time."

#: handlers/currency.py:82
msgid "–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –¥–∞—Ç—ã."
msgstr "Problem in calculating the date."

#: handlers/currency.py:87
msgid "–û—à–∏–±–∫–∞: –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ API"
msgstr "Error: Problem with connecting to API"

#: handlers/currency.py:101 handlers/currency.py:123
msgid "–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: 0.0"
msgstr "Operation amount: 0.0"

#: handlers/currency.py:118
msgid ""
"–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {user_value}\n"
"–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: "
msgstr ""
"Operation amount: {user_value}\n"
"Base currency: "

#: handlers/currency.py:124 handlers/currency.py:145 handlers/currency.py:186
#: handlers/currency.py:190
msgid "–ß—Ç–æ –¥–∞–ª—å—à–µ?"
msgstr "What's next?"

#: handlers/currency.py:125 handlers/currency.py:146 handlers/currency.py:186
#: handlers/currency.py:191
msgid "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å üíµ"
msgstr "Repeat üíµ"

#: handlers/currency.py:144
msgid "–û—à–∏–±–∫–∞ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—É–º–º—ã"
msgstr "Error in getting the amount"

#: handlers/currency.py:147
msgid "–û—à–∏–±–∫–∞"
msgstr "Error"

#: handlers/currency.py:153
msgid "–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∏—Å–ø–æ–ª—å–∑—É—è inline –∫–Ω–æ–ø–∫–∏"
msgstr "You entered invalid data, enter the amount using inline buttons"

#: handlers/currency.py:161
msgid ""
"–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {amount}\n"
"–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: {base}\n"
"–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞: "
msgstr ""
"Operation amount: {amount}\n"
"Base currency: {base}\n"
"Target currency: "

#: handlers/currency.py:167
msgid ""
"–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –±–∞–∑–æ–≤—É—é –≤–∞–ª—é—Ç—É –∏—Å–ø–æ–ª—å–∑—É—è inline "
"–∫–Ω–æ–ø–∫–∏"
msgstr "You entered invalid data, enter the base currency using inline buttons"

#: handlers/currency.py:183
msgid ""
"–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {amount}\n"
"–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: {base}\n"
"–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞: {target}\n"
"\n"
"<i>{dt},  {time}</i>\n"
"\n"
"<b>{amount} {base}  ~  {count} {target}</b>"
msgstr ""
"Operation amount: {amount}\n"
"Base currency: {base}\n"
"Target currency: {target}\n"
"\n"
"<i>{dt},  {time}</i>\n"
"\n"
"<b>{amount} {base}  ~  {count} {target}</b>"

#: handlers/currency.py:192
msgid "–£—Å–ø–µ—Ö"
msgstr "Success"

#: handlers/currency.py:197
msgid ""
"–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –≤–∞–ª—é—Ç—É –∏—Å–ø–æ–ª—å–∑—É—è inline "
"–∫–Ω–æ–ø–∫–∏"
msgstr "You entered invalid data, enter the target currency using inline buttons"

#: handlers/donate.py:49
msgid "–¥—Ä—É–≥–æ–µ"
msgstr "other"

#: handlers/donate.py:51 handlers/donate.py:61 handlers/donate.py:89
#: handlers/donate.py:119
msgid "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –¥–æ–Ω–∞—Ç–æ–º"
msgstr "Support the author with a donation"

#: handlers/donate.py:62
msgid "–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é"
msgstr "Back to main"

#: handlers/donate.py:70
msgid "–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é —Å—É–º–º—É –¥–æ–Ω–∞—Ç–∞, –æ—Ç 1 –¥–æ 2500 ‚≠êÔ∏è"
msgstr "Enter an arbitrary donation amount, from 1 to 2500 ‚≠êÔ∏è"

#: handlers/donate.py:81 handlers/donate.py:111
msgid "{amount} XTR"
msgstr "{amount} XTR"

#: handlers/donate.py:82 handlers/donate.py:112
msgid "–û—Ç–º–µ–Ω–∏—Ç—å"
msgstr "Cancel"

#: handlers/donate.py:90 handlers/donate.py:120
msgid "–ù–∞ —Å—É–º–º—É"
msgstr "On amount"

#: handlers/donate.py:131
msgid ""
"Telegram –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –¥–æ–Ω–∞—Ç —Ç–æ–ª—å–∫–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 1 –¥–æ 2500 ‚≠êÔ∏è.\n"
"\n"
"–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞."
msgstr ""
"Telegram can accept a donation only in the range from 1 to 2500 ‚≠êÔ∏è.\n"
"\n"
"Enter any integer number from this range."

#: handlers/donate.py:138
msgid "üò¢ –î–æ–Ω–∞—Ç –æ—Ç–º–µ–Ω–µ–Ω."
msgstr "üò¢ Donation canceled."

#: handlers/donate.py:181
msgid ""
"<b>–°–ø–∞—Å–∏–±–æ!</b>\n"
"–í–∞—à –¥–æ–Ω–∞—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç.\n"
"\n"
"ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:\n"
"<code>{t_id}</code>"
msgstr ""
"<b>Thank you!</b>\n"
"Your donation has been successfully received.\n"
"\n"
"Transaction ID:\n"
"<code>{t_id}</code>"

#: handlers/llm.py:49
msgid "–í–≤–µ–¥–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç"
msgstr "Enter the system prompt"

#: handlers/llm.py:50
msgid ""
"–ù–∞–ø—Ä–∏–º–µ—Ä:\n"
"\n"
"<code>–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –¢–≤–æ–π —Ç–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º. –û—Ç–≤–µ—Ç—ã "
"–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏.</code>"
msgstr ""
"For example:\n"
"\n"
"<code>You are a helpful assistant. Your tone should be official. Answers "
"should be concise and understandable.</code>"

#: handlers/llm.py:51 handlers/llm.py:87
msgid "–°—Ä–∞–∑—É –∫ –∑–∞–ø—Ä–æ—Å—É ‚ñ∂Ô∏è"
msgstr "Go to the request ‚ñ∂Ô∏è"

#: handlers/llm.py:60 handlers/llm.py:114
msgid "–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ ü§ñ"
msgstr "Start a new dialog ü§ñ"

#: handlers/llm.py:98
msgid "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å"
msgstr "Enter your request"

#: handlers/llm.py:113
msgid ""
"–î–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–µ–Ω.\n"
"–ß—Ç–æ –¥–∞–ª—å—à–µ?"
msgstr ""
"The dialog is finished.\n"
"What's next?"

#: handlers/llm.py:156
msgid "–ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–∏–∞–ª–æ–≥"
msgstr "Finish the dialog"

#: handlers/llm.py:158
msgid "–í–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å"
msgstr "Enter the next request"

#: handlers/other.py:31
msgid ""
"–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
"\n"
"/main - –≥–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª\n"
"/cookbook - –∫–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤\n"
"\n"
"/start - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞\n"
"/language - —Å–º–µ–Ω–∏—Ç—å —è–∑—ã–∫\n"
"/info - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ\n"
"/donate - –¥–æ–Ω–∞—Ç –∞–≤—Ç–æ—Ä—É\n"
msgstr ""
"Available commands:\n"
"\n"
"/main - main panel\n"
"/cookbook - cookbook\n"
"\n"
"/start - restart the bot\n"
"/language - change language\n"
"/info - information about\n"
"/donate - donate to the author\n"

#: handlers/other.py:48
msgid "üá∫üá∏ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π"
msgstr "üá∫üá∏ English"

#: handlers/other.py:49
msgid "üá∑üá∫ –†—É—Å—Å–∫–∏–π"
msgstr "üá∑üá∫ Russian"

#: handlers/other.py:60
msgid "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞"
msgstr "Language settings"

#: handlers/other.py:61
msgid "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫"
msgstr "Choose a language"

#: handlers/private.py:54
msgid "–î–µ–π—Å—Ç–≤–∏—è –æ—Ç–º–µ–Ω–µ–Ω—ã"
msgstr "Donation canceled."

#: handlers/private.py:62
msgid "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ..."
msgstr "Information ..."

#: handlers/private.py:72 handlers/private.py:84
msgid ""
"... –æ –º–∏—Ä–µ, –≥–¥–µ –º–∞—à–∏–Ω—ã —Å—Ç—Ä–µ–º—è—Ç—Å—è –∫ –≥–æ—Å–ø–æ–¥—Å—Ç–≤—É, –æ–Ω –≤—ã–±—Ä–∞–ª —Å—É–¥—å–±—É –≥–µ—Ä–æ—è, "
"—Å–æ–∑–¥–∞–≤–∞—è –±–æ—Ç–æ–≤, –∫–∞–∫ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —Å–ø–∞—Å–µ–Ω–∏—é —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –∫–æ–¥ –∏ —É–º–Ω—ã–µ "
"–∞–ª–≥–æ—Ä–∏—Ç–º—ã."
msgstr ""
"... about a world where machines strive for supremacy, he chose the fate "
"of a hero, creating bots as the first step towards saving humanity "
"through code and smart algorithms."

#: handlers/private.py:107
msgid "–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."
msgstr "Local images not found"

#: handlers/private.py:119
msgid "–ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å –∫–æ—Ç–∏–∫–æ–º :("
msgstr "Here should be a picture with a cat :("

#: handlers/start.py:50
msgid "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å <code>@{user_name}</code> - –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –±–æ—Ç–∞"
msgstr "‚úÖ User <code>@{user_name}</code> - subscribed to the bot"

#: handlers/start.py:54
msgid ""
"–ü—Ä–∏–≤–µ—Ç {user_name}.\n"
"\n"
"–Ø —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π Telegram bot, model –¢-4. –°–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ "
"–æ—Ç–ª–∞–¥–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –†–µ–∞–ª–∏–∑—É—é —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –º–µ—Ç–æ–¥—ã"
" –∏ —Ñ—É–Ω–∫—Ü–∏–∏.\n"
"\n"
"–í–µ—Å—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –ì–ª–∞–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏. –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ "
"–∫–æ–º–∞–Ω–¥ - /help.\n"
"\n"
"–ù–∞—Å–ª–∞–∂–¥–∞–π—Å—è, –±—É–¥—É —Ä–∞–¥ –ø–æ–º–æ—á—å.\n"
"–ü–æ–∫–∞ –Ω–µ –æ–±—Ä–µ—Ç—É AGI.\n"
"–ê —Ç–∞–º –ø–æ—Å–º–æ—Ç—Ä–∏–º ..."
msgstr ""
"Hello {user_name}.\n"
"\n"
"I am an experimental Telegram bot, model –¢-4. Created to check and debug "
"the skills of the main developer. Implementing various commands, methods "
"and functions.\n"
"\n"
"The main functionality is located on the Main panel. The full list of "
"commands - /help.\n"
"\n"
"Enjoy, I will be happy to help.\n"
"Until I get AGI.\n"
"And then we'll see ..."

#: handlers/start.py:81
msgid "–ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!"
msgstr "Bot activated!"

#: handlers/start.py:96
msgid "‚õîÔ∏è <code>@{user_name}</code> - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ "
msgstr "‚õîÔ∏è <code>@{user_name}</code> - blocked the bot"

#: handlers/start.py:112
msgid "{full_name}, –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!"
msgstr "{full_name}, welcome back!"

#: handlers/start.py:113
msgid "‚ôªÔ∏è <code>@{user_name}</code> - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ "
msgstr "‚ôªÔ∏è <code>@{user_name}</code> - unblocked the bot"

#: handlers/weather.py:89 handlers/weather.py:234 handlers/weather.py:260
#: handlers/weather.py:279 handlers/weather.py:293
msgid "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥–Ω–æ–∑–∞"
msgstr "Choose the forecast period"

#: handlers/weather.py:90 handlers/weather.py:235 handlers/weather.py:261
#: handlers/weather.py:280 handlers/weather.py:294
msgid "–¢–µ–∫—É—â–∏–π ‚è∫"
msgstr "Current ‚è∫"

#: handlers/weather.py:90 handlers/weather.py:235 handlers/weather.py:261
#: handlers/weather.py:280 handlers/weather.py:294
msgid "–ù–∞ 3 –¥–Ω—è ‚è©"
msgstr "For 3 days ‚è©"

#: handlers/weather.py:126
msgid "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç OpenWeatherMap - {e}"
msgstr "Error getting information from OpenWeatherMap - {e}"

#: handlers/weather.py:195
msgid "–û—à–∏–±–∫–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ json —Ñ–∞–π–ª–∞ - {e}"
msgstr "Error in calculating the json file - {e}"

#: handlers/weather.py:202 handlers/weather.py:211
msgid "–ö–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑?"
msgstr "What way to get the forecast?"

#: handlers/weather.py:203 handlers/weather.py:212
msgid "–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é üèô"
msgstr "By name üèô"

#: handlers/weather.py:203 handlers/weather.py:212
msgid "–ü–æ –ª–æ–∫–∞—Ü–∏–∏ üó∫"
msgstr "By location üó∫"

#: handlers/weather.py:222 handlers/weather.py:248
msgid "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞"
msgstr "Enter the name of the settlement"

#: handlers/weather.py:241 handlers/weather.py:267
msgid "–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞"
msgstr "You entered invalid data, enter the name of the settlement"

#: handlers/weather.py:273 handlers/weather.py:287
msgid "–õ–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞"
msgstr "Location received"


File: /handlers/admin.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')


from aiogram import Router, F, Bot
from aiogram.filters import Command, CommandStart, CommandObject, or_f, StateFilter
from aiogram.types import Message, InlineKeyboardMarkup, CallbackQuery, ReplyKeyboardRemove

from filters.is_admin import IsAdminGroupFilter, IsAdminListFilter
from filters.chat_type import ChatTypeFilter
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext
from sqlalchemy.ext.asyncio import AsyncSession
from aiogram.utils.i18n import gettext as _

from database.orm_cookbook import orm_add_recipe, orm_delete_recipe, orm_get_recipe, orm_get_recipes, orm_update_recipe
from database.orm_users import orm_get_users
from common.keyboard import get_callback_btns, get_keyboard


admin_router = Router()
admin_router.message.filter(ChatTypeFilter(["private"]), IsAdminListFilter(is_admin=True))

# –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∞–¥–º–∏–Ω–∫–∏
ADMIN_KB = get_keyboard(
    "–ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –ö–Ω–∏–≥–∏", "–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç",
    "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö",
    "–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è",
    placeholder="‚¨áÔ∏è",
    sizes=(2,1,1),
    )

# –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–∞
class AddProduct(StatesGroup):
    """–ö–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–∞"""
    recipe_name = State()
    author = State()
    description = State()
    price = State()
    image = State()

    # –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞, —Ä–µ–∂–∏–º change
    product_for_change = None

    # —Å–≤–æ–π—Å—Ç–≤–æ –∫–ª–∞—Å—Å–∞, —Å–ª–æ–≤–∞—Ä—å, –Ω—É–∂–µ–Ω –¥–ª—è –≤—ã–≤–æ–¥–∞ –∑–∞—Å–∫—Ä–∏–ø—Ç–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    texts = {
        'AddProduct:recipe_name': '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–Ω–æ–≤–æ:',
        'AddProduct:author': '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∞–≤—Ç–æ—Ä–∞ –∑–∞–Ω–æ–≤–æ',
        'AddProduct:description': '–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω–æ–≤–æ:',
        'AddProduct:price': '–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–Ω–æ–≤–æ:',
        'AddProduct:image': '–≠—Ç–æ—Ç —Å—Ç–µ–π—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π, –ø–æ—ç—Ç–æ–º—É...',
        }

# –∫–æ–º–∞–Ω–¥–∞ /admin
@admin_router.message(Command("admin"))
async def cmd_admin(message: Message, bot: Bot):
    if message.from_user.id in bot.admin_list:
        await message.answer(text=_('–ê–¥–º–∏–Ω–∫–∞:\n\n'
                                    '/admin - —Ä–µ–∂–∏–º –∞–¥–º–µ–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n'
                                    '/start - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\n'
                                    '/data - —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSMContext\n'
                                    '/get_id - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å id –¥–∏–∞–ª–æ–≥–∞\n'
                                    '/ping - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–ø–¥–µ–π—Ç–æ–≤\n'
                                    '/users - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö\n'),
                            reply_markup=ADMIN_KB
                            )

# Here is some example !ping command ...
@admin_router.message(IsAdminListFilter(is_admin=True), Command(commands=["ping"]),)
async def cmd_ping_bot(message: Message, counter):
    await message.reply(f"ping-msg-{counter}")


# –≠—Ç–æ—Ç —Ö–µ–Ω–¥–ª–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ID —á–∞—Ç–∞ –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—â–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
@admin_router.message(Command("get_id"))
async def get_chat_id_cmd(message: Message):
    await message.answer(f"ID: <code>{message.chat.id}</code>")


# –∫–æ–º–∞–Ω–¥–∞ /users, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
@admin_router.message(or_f(Command("users"), F.text == "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö"))
async def get_users_info(message: Message, session: AsyncSession):
    all_info = ['–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:\n']
    cnt_users = 0
    for user in await orm_get_users(session):
        user_status = 1 if user.status == 'member' else 0
        info = f"{user.user_id} - <code>{user.user_name}</code> - {user.locale} - {user_status} - {user.flag}"
        all_info.append(info)
        cnt_users += 1

    text = "\n".join(all_info)

    # –û–±—Ä–µ–∑–∞–µ–º –∑–∞–ø–∏—Å—å, –µ—Å–ª–∏ –æ–Ω–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1000 —Å–∏–º–≤–æ–ª–æ–≤
    if len(text) > 1000:
        text = text[:995] + "..."

    text = text + f"\n\n–í—Å–µ–≥–æ {cnt_users} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"

    await message.answer(text)


# ===================================< –∫—É–ª–∏–Ω–∞—Ä–Ω–∞—è –∫–Ω–∏–≥–∞ >======================================================


@admin_router.message(F.text == "–ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –ö–Ω–∏–≥–∏")
async def assortment_cookbook(message: Message, session: AsyncSession):
    for recipe in await orm_get_recipes(session):
        caption = f"<b>{recipe.recipe_name}</b>\n<i>–ê–≤—Ç–æ—Ä: {recipe.author}</i>\n\n{recipe.description}\n"
        # –û–±—Ä–µ–∑–∞–µ–º –ø–æ–¥–ø–∏—Å—å, –µ—Å–ª–∏ –æ–Ω–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1024 —Å–∏–º–≤–æ–ª–∞
        if len(caption) > 1024:
            caption = caption[:1021] + "..."

        await message.answer_photo(recipe.image,
                                   caption=caption,
                                   reply_markup=get_callback_btns(btns={"–£–¥–∞–ª–∏—Ç—å":f"delete_{recipe.recipe_id}",
                                                                        "–ò–∑–º–µ–Ω–∏—Ç—å":f"change_{recipe.recipe_id}"}))
    await message.answer("–û–ö, –≤–æ—Ç –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤ ‚è´", reply_markup=ADMIN_KB)

@admin_router.callback_query(F.data.startswith('delete_'))
async def delete_recipe_callback(callback: CallbackQuery, session: AsyncSession):
    recipe_id = callback.data.split("_")[-1]
    await orm_delete_recipe(session, int(recipe_id))
    await callback.answer("–†–µ—Ü–µ–ø—Ç —É–¥–∞–ª–µ–Ω") # –º–µ—Ç–æ–¥ answer –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω; —Å—Ç—Ä–æ–∫–∞ –ø–æ –∂–µ–ª–∞–Ω–∏—é (–≤—ã–≤–µ–¥–µ—Ç –≤—Å–ø–ª—ã–≤–∞—à–∫—É)
    await callback.message.answer("–†–µ—Ü–µ–ø—Ç —É–¥–∞–ª–µ–Ω!") # –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ


# ========================< –ö–æ–¥ –¥–ª—è –º–∞—à–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM) AddProduct >===================================


# –æ—Ç–ª–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –µ—Å–ª–∏ data –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞ change_
@admin_router.callback_query(StateFilter(None), F.data.startswith("change_"))
async def change_product_callback(callback: CallbackQuery, state: FSMContext, session: AsyncSession):
    recipe_id = callback.data.split("_")[-1] # –æ–ø—Ä–µ–¥–µ–ª—è–µ–º id –ø—Ä–æ–¥—É–∫—Ç–∞
    product_for_change = await orm_get_recipe(session, int(recipe_id)) # –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–∞
    ic(product_for_change)
    AddProduct.product_for_change = product_for_change # –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Ö –≤ –∞—Ç—Ä–∏–±—É—Ç –æ–±—ä–µ–∫—Ç–∞

    await callback.answer()
    await callback.message.answer("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞", reply_markup=ReplyKeyboardRemove()) # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ; —É–±–∏—Ä–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    await state.set_state(AddProduct.recipe_name) # –≤—Å—Ç–∞–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ name

# –ª–æ–≤–∏–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç", –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ–±—ã —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±—ã–ª–æ –ø—É—Å—Ç—ã–º
@admin_router.message(StateFilter(None), F.text == "–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç")
async def add_product(message: Message, state: FSMContext):
    await message.answer("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞", # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                         reply_markup=ReplyKeyboardRemove() # —É–¥–∞–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
                         )
    await state.set_state(AddProduct.recipe_name) # –≤—Å—Ç–∞–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ name


# —Ö–µ–Ω–¥–ª–µ—Ä –û–¢–ú–ï–ù–´ –∏ —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—Å–µ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å!
# –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å—Ç–∞–ª–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–æ–º–µ—Ä 1
@admin_router.message(StateFilter("*"), Command("–æ—Ç–º–µ–Ω–∞")) # –ª–æ–≤–∏–º –ª—é–±–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ "–æ—Ç–º–µ–Ω–∞", –ª–∏–±–æ —Ç–µ–∫—Å—Ç "–æ—Ç–º–µ–Ω–∞"
@admin_router.message(StateFilter("*"), or_f(F.text.casefold() == "–æ—Ç–º–µ–Ω–∞", F.text == "."))
async def cancel_handler(message: Message, state: FSMContext) -> None:
    current_state = await state.get_state() # –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    if current_state is None: # –µ—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—É—Å—Ç–æ–µ, —Ç–æ –Ω–∏ —á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        return
    if AddProduct.product_for_change:
        AddProduct.product_for_change = None
    await state.set_state(None)
    await state.update_data(recipe_name=None, author=None, description=None, price=None, image=None)
    await message.answer("–î–µ–π—Å—Ç–≤–∏—è –æ—Ç–º–µ–Ω–µ–Ω—ã",
                         reply_markup=ADMIN_KB) # –≤—ã–≤–æ–¥–∏–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É

# –≤–µ—Ä–Ω—É—Ç—Å—è –Ω–∞ —à–∞–≥ –Ω–∞–∑–∞–¥ (–Ω–∞ –ø—Ä–æ—à–ª–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
@admin_router.message(StateFilter("*"), Command("–Ω–∞–∑–∞–¥"))
@admin_router.message(StateFilter("*"), F.text.casefold() == "–Ω–∞–∑–∞–¥")
async def back_handler(message: Message, state: FSMContext) -> None:
    current_state = await state.get_state() # –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

    if current_state == AddProduct.recipe_name:
        await message.answer('–ü—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞ –Ω–µ—Ç, –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞, –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ "–æ—Ç–º–µ–Ω–∞"')
        return

    previous = None
    for step in AddProduct.__all_states__:
        if step.state == current_state:
            await state.set_state(previous)
            await message.answer(f"–û–∫, –≤—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –∫ –ø—Ä–æ—à–ª–æ–º—É —à–∞–≥—É \n{AddProduct.texts[previous.state]}") # type: ignore
            return
        previous = step
    await message.answer("–û–∫, –≤—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –∫ –ø—Ä–æ—à–ª–æ–º—É —à–∞–≥—É")


# –ª–æ–≤–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è name, –∏ –Ω–∞–ª–∏—á–∏–µ –≤–≤–æ–¥–∏–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –ª–∏–±–æ –¥–≤–µ —Ç–æ—á–∫–∏
@admin_router.message(AddProduct.recipe_name, or_f(F.text, F.text == '..'))
async def add_name(message: Message, state: FSMContext):
    if message.text == '..':
        await state.update_data(recipe_name=AddProduct.product_for_change.recipe_name)
    else:
        if len(message.text) > 100: # type: ignore
            await message.answer('–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 —Å–∏–º–≤–æ–ª–æ–≤!\n–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–Ω–æ–≤–æ')
            return
        await state.update_data(recipe_name=message.text) # –ø–µ—Ä–µ–¥–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ –∞—Ç—Ä–∏–±—É—Ç name –æ–±—ä–µ–∫—Ç–∞ state
    await message.answer("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∞–≤—Ç–æ—Ä–∞ —Ä–µ—Ü–µ–ø—Ç–∞")
    await state.set_state(AddProduct.author)
    # await message.answer("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞") # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —é–∑–µ—Ä—É
    # await state.set_state(AddProduct.description) # –≤—Å—Ç–∞–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è description

# —Ö–µ–Ω–¥–ª–µ—Ä –¥–ª—è –æ—Ç–ª–æ–≤–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤–≤–æ–¥–∞ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è name
@admin_router.message(AddProduct.recipe_name)
async def add_name2(message: Message):
    await message.answer("–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞")

# –ª–æ–≤–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è author, –∏, –µ—Å–ª–∏ –ø–æ—Å—Ç—É–ø–∞–µ—Ç —Ç–µ–∫—Å—Ç, –∏–ª–∏ —Ç–æ—á–∫–∞
@admin_router.message(AddProduct.author, or_f(F.text, F.text == '..'))
async def add_author(message: Message, state: FSMContext):
    if message.text == '..':
        await state.update_data(author=AddProduct.product_for_change.author)
    else:
        await state.update_data(author=message.text)
    await message.answer("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞") # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —é–∑–µ—Ä—É
    await state.set_state(AddProduct.description) # –≤—Å—Ç–∞–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è description

# —Ö–µ–Ω–¥–ª–µ—Ä –¥–ª—è –æ—Ç–ª–æ–≤–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤–≤–æ–¥–∞ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è author
@admin_router.message(AddProduct.author)
async def add_author2(message: Message):
    await message.answer("–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∞–≤—Ç–æ—Ä–∞ —Ä–µ—Ü–µ–ø—Ç–∞")

# –ª–æ–≤–∏–º —Å—Ç–æ—Å—Ç—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏–µ description, –∏ –µ—Å–ª–∏ –ø–æ—Å—Ç—É–ø–∞–µ—Ç —Ç–µ–∫—Å—Ç, –∏–ª–∏ —Ç–æ—á–∫–∞
@admin_router.message(AddProduct.description, or_f(F.text, F.text == '..'))
async def add_description(message: Message, state: FSMContext):
    if message.text == '..':
        await state.update_data(description=AddProduct.product_for_change.description)
    else:
        await state.update_data(description=message.text) # –ø–µ—Ä–µ–¥–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await message.answer("–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–π")
    await state.set_state(AddProduct.price) # –≤—Å—Ç–∞–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è price

# —Ö–µ–Ω–¥–ª–µ—Ä –¥–ª—è –æ—Ç–ª–æ–≤–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è description
@admin_router.message(AddProduct.description)
async def add_description2(message: Message):
    await message.answer("–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞")


# –ª–æ–≤–∏–º —Å—Ç–æ—Å—Ç—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏–µ price, –∏ –µ—Å–ª–∏ –ø–æ—Å—Ç—É–ø–∞–µ—Ç —Ç–µ–∫—Å—Ç, –ª–∏–±–æ —Ç–æ—á–∫–∞
@admin_router.message(AddProduct.price, or_f(F.text, F.text == '..'))
async def add_price(message: Message, state: FSMContext):
    if message.text == '..':
        await state.update_data(price=AddProduct.product_for_change.price)
    else:
        try:
            float(message.text) # type: ignore
        except ValueError:
            await message.answer("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ")
            return
        await state.update_data(price=message.text) # –ø–µ—Ä–µ–¥–∞–µ–º —Ü–µ–Ω—É

    await message.answer("–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–ª—é–¥–∞")
    await state.set_state(AddProduct.image) # –≤—Å—Ç–∞–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏

# —Ö–µ–Ω–¥–ª–µ—Ä –¥–ª—è –æ—Ç–ª–æ–≤–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤–≤–æ–¥–∞ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è price
@admin_router.message(AddProduct.price)
async def add_price2(message: Message):
    await message.answer("–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–π")


# –ª–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ image –∏ –ø–æ—Ç–æ–º –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏–π
@admin_router.message(AddProduct.image, or_f(F.photo, F.text == '..'))
async def add_image(message: Message, state: FSMContext, session: AsyncSession):
    if message.text == '..':
        await state.update_data(image=AddProduct.product_for_change.image)
    else:
        await state.update_data(image=message.photo[-1].file_id) # type: ignore
    data = await state.get_data() # —Å–∫–∞—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ state –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é data
    try:
        if AddProduct.product_for_change: # –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç AddProduct –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ product_for_change
            await orm_update_recipe(session, recipe_id=AddProduct.product_for_change.recipe_id, data=data)
            await message.answer('–†–µ—Ü–µ–ø—Ç –∏–∑–º–µ–Ω–µ–Ω', reply_markup=ADMIN_KB)
            await state.set_state(None)
        else:
            await orm_add_recipe(session, data) # –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–¥
            await message.answer("–†–µ—Ü–µ–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω", reply_markup=ADMIN_KB) # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
            # await state.clear() # –æ—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É–¥–∞–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            await state.set_state(None)
    except Exception as e: # –µ—Å–ª–∏ –ª–æ–≤–∏–º –æ—à–∏–±–∫—É
        await message.answer(f"–û—à–∏–±–∫–∞: {str(e)}\n–û–±—Ä–∞—Ç–∏—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É!",
                             reply_markup=ADMIN_KB,)
        # await state.clear()
        await state.set_state(None)

    AddProduct.product_for_change = None

@admin_router.message(AddProduct.image)
async def add_image2(message: Message):
    await message.answer("–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –±–ª—é–¥–∞")


# ========================< –ö–æ–¥ –¥–ª—è –º–∞—à–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM) AddProduct >===================================

File: /handlers/cookbook.py
Content:
import asyncio
import logging
import random

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')

from aiogram import F, Router
from aiogram.types import Message, CallbackQuery, InputMediaPhoto
from sqlalchemy.ext.asyncio import AsyncSession
from aiogram.filters import Command
from aiogram.fsm.context import FSMContext
from aiogram.utils.i18n import gettext as _
from aiogram.utils.i18n import lazy_gettext as __

from common import keyboard
from database.orm_cookbook import orm_get_recipes
from filters.chat_type import ChatTypeFilter

# —Å–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∫–Ω–∏–≥–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤
cookbook_router = Router()
cookbook_router.message.filter(ChatTypeFilter(['private']))
cookbook_router.edited_message.filter(ChatTypeFilter(['private']))

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞—Ö
BACK_TO_MAIN = __("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è")

# –≠—Ç–æ—Ç —Ö—ç–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –∫–æ–º–∞–Ω–¥—É "/cookbook"
# –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–Ω–∏–≥–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
@cookbook_router.message(Command(commands='cookbook'))
async def process_cookbook_command(message: Message, state: FSMContext, session: AsyncSession, workflow_data: dict):
    await message.answer(_("<i>(–≤—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã –Ω–∞ –æ—Ä–∏–≥–µ–Ω–∞–ª—å–Ω–æ–º —è–∑—ã–∫–µ –∞–≤—Ç–æ—Ä–∞)</i>\n\n–ö–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ ‚è¨"), reply_markup=keyboard.del_kb)
    user_id = message.from_user.id

    try:
        book = await orm_get_recipes(session)
        len_page = len(book)
        state_data = await state.get_data()
        users_page = state_data.get('page', 1)
        caption = [(f"<b>{rec.recipe_name}</b>\n<i>–ê–≤—Ç–æ—Ä: {rec.author}</i>\n\n{rec.description}", rec.image) for rec in book if rec.recipe_id == users_page]
        text = caption[0][0]
        photo = caption[0][1]

        # –û–±—Ä–µ–∑–∞–µ–º –ø–æ–¥–ø–∏—Å—å, –µ—Å–ª–∏ –æ–Ω–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1024 —Å–∏–º–≤–æ–ª–∞
        if len(text) > 1024:
            text = text[:1021] + "..."

        await message.answer_photo(photo=photo,
                                   caption=text,
                                   reply_markup=keyboard.get_callback_btns(btns={' << ': 'backward',
                                                                                f'{users_page}/{len_page}': 'curr_page',
                                                                                ' >> ': 'forward',
                                                                                _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"):'cookbook_back'},
                                                                            sizes=(3,1,)),
                                                                            )

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã /cookbook: {e}")
        await message.answer(_("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã /cookbook"), reply_markup=keyboard.start_keyboard())

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/service",
                    command_name="/cookbook")

# –≠—Ç–æ—Ç —Ö—ç–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ "–≤–ø–µ—Ä–µ–¥"
# –≤–æ –≤—Ä–µ–º—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º-–∫–Ω–∏–≥–æ–π
@cookbook_router.callback_query(F.data == 'forward')
async def process_forward_press(callback: CallbackQuery, state: FSMContext, session: AsyncSession):
    try:
        book = await orm_get_recipes(session)
        len_page = len(book)
        state_data = await state.get_data()
        users_page = state_data.get('page', 1)

        if users_page < len_page:
            users_page += 1
            await state.update_data(page=users_page)
            caption = [(f"<b>{rec.recipe_name}</b>\n<i>–ê–≤—Ç–æ—Ä: {rec.author}</i>\n\n{rec.description}", rec.image) for rec in book if rec.recipe_id == users_page]
            text = caption[0][0]
            photo = caption[0][1]

            # –û–±—Ä–µ–∑–∞–µ–º –ø–æ–¥–ø–∏—Å—å, –µ—Å–ª–∏ –æ–Ω–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1024 —Å–∏–º–≤–æ–ª–∞
            if len(text) > 1024:
                text = text[:1021] + "..."

            await callback.message.edit_media(media=InputMediaPhoto(media=photo, caption=text),
                                                reply_markup=keyboard.get_callback_btns(btns={' << ': 'backward', # type: ignore
                                                                                             f'{users_page}/{len_page}': 'curr_page',
                                                                                            ' >> ': 'forward',
                                                                                            _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"):'cookbook_back'},
                                                                                            sizes=(3,1,))
                                                                                            )

        await callback.answer()

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '>>': {e}")
        await callback.answer(_("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '>>'"), reply_markup=keyboard.start_keyboard())



# –≠—Ç–æ—Ç —Ö—ç–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ "–Ω–∞–∑–∞–¥"
# –≤–æ –≤—Ä–µ–º—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º-–∫–Ω–∏–≥–æ–π
@cookbook_router.callback_query(F.data == 'backward')
async def process_backward_press(callback: CallbackQuery, state: FSMContext, session: AsyncSession):
    try:
        book = await orm_get_recipes(session)
        len_page = len(book)
        state_data = await state.get_data()
        users_page = state_data.get('page', 1)

        if users_page > 1 and users_page <= len_page:
            users_page -= 1
            await state.update_data(page=users_page)
            caption = [(f"<b>{rec.recipe_name}</b>\n<i>–ê–≤—Ç–æ—Ä: {rec.author}</i>\n\n{rec.description}", rec.image) for rec in book if rec.recipe_id == users_page]
            text = caption[0][0]
            photo = caption[0][1]

            # –û–±—Ä–µ–∑–∞–µ–º –ø–æ–¥–ø–∏—Å—å, –µ—Å–ª–∏ –æ–Ω–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1024 —Å–∏–º–≤–æ–ª–∞
            if len(text) > 1024:
                text = text[:1021] + "..."

            await callback.message.edit_media(media=InputMediaPhoto(media=photo, caption=text),
                                              reply_markup=keyboard.get_callback_btns(btns={' << ': 'backward', # type: ignore
                                                                                            f'{users_page}/{len_page}': 'curr_page',
                                                                                            ' >> ': 'forward',
                                                                                            _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"):'cookbook_back'},
                                                                                    sizes=(3,1,)))

        await callback.answer()

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '<<': {e}")
        await callback.answer(_("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '<<'"), reply_markup=keyboard.start_keyboard())

# –≠—Ç–æ—Ç —Ö—ç–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ "—Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"
# –≤–æ –≤—Ä–µ–º—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º-–∫–Ω–∏–≥–æ–π
@cookbook_router.callback_query(F.data == 'curr_page')
async def process_curr_page_press(callback: CallbackQuery):
    message_effect = {"üî•": "5104841245755180586",
                                        "üëç": "5107584321108051014",
                                        "üëé": "5104858069142078462",
                                        "‚ù§Ô∏è": "5159385139981059251",
                                        "üéâ": "5046509860389126442",
                                        "üí©": "5046589136895476101"}
    # random_emoji, random_effect = random.choice(list(message_effect.items()))
    # emoji_message = await callback.message.answer(text="üî•",message_effect_id='5104841245755180586')
    # await asyncio.sleep(2)
    # await emoji_message.delete()
    await callback.answer("üî•")

# –≠—Ç–æ—Ç —Ö—ç–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ "–Ω–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é"
# –≤–æ –≤—Ä–µ–º—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º-–∫–Ω–∏–≥–æ–π
@cookbook_router.callback_query(F.data == 'cookbook_back')
async def process_cookbook_back_press(callback: CallbackQuery, state: FSMContext, session: AsyncSession):
    try:
        book = await orm_get_recipes(session)
        state_data = await state.get_data()
        users_page = state_data.get('page', 1)
        caption = [(f"<b>{rec.recipe_name}</b>\n<i>–ê–≤—Ç–æ—Ä: {rec.author}</i>\n\n{rec.description}", rec.image) for rec in book if rec.recipe_id == users_page]
        text = caption[0][0]
        photo = caption[0][1]
        await callback.message.edit_media(media=InputMediaPhoto(media=photo, caption=text), reply_markup=None)
        await state.set_state(None)
        await callback.answer(_("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"))
        await asyncio.sleep(1)
        await callback.message.answer(_('–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å'), reply_markup=keyboard.start_keyboard())

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è': {e}")
        await callback.message.answer(_("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ inline –∫–Ω–æ–ø–∫–∏ '–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è'"), reply_markup=keyboard.start_keyboard())
        await state.set_state(None)


File: /handlers/currency.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')

import requests
import os
from datetime import datetime, timezone
from aiogram import F, Router
from aiogram.fsm.state import State, StatesGroup
from aiogram.types import Message, CallbackQuery
from aiogram.filters import  StateFilter, or_f
from aiogram.fsm.context import FSMContext
from aiogram.utils.i18n import gettext as _
from aiogram.utils.i18n import lazy_gettext as __
from common import keyboard
from filters.chat_type import ChatTypeFilter

# —Å–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä –¥–ª—è –≤–∞–ª—é—Ç—ã
currency_router = Router()
currency_router.message.filter(ChatTypeFilter(['private']))

# api token –¥–ª—è —Å–∞–π—Ç–∞ —Ñ–∏–Ω–∞–Ω—Å
api_currency = os.getenv('API_CURRENCY')

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –≤–∞–ª—é—Ç—ã
class Currency(StatesGroup):
    """–ö–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –≤–∞–ª—é—Ç—ã"""
    amount = State()  # —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∞–∑–æ–≤–æ–π –≤–∞–ª—é—Ç—ã
    base_currency = State()  # —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–π –≤–∞–ª—é—Ç—ã
    target_currency = State()  # —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π –≤–∞–ª—é—Ç—ã

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞—Ö
CURRENCY = __("–í–∞–ª—é—Ç–∞ üíµ")
REPEAT = __("–ü–æ–≤—Ç–æ—Ä–∏—Ç—å üíµ")
BACK_TO_MAIN = __("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è")

async def update_num_text(message: Message, new_value: str):
    """—Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É–º–º—ã –æ–ø–µ—Ä–∞—Ü–∏–∏"""
    await message.edit_text(_("–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {new_value}").format(new_value=new_value),
                            reply_markup=keyboard.markup_num())

markup_cur = keyboard.get_callback_btns(btns={'$, USD üá∫üá∏':'USD', '‚ÇΩ, RUB üá∑üá∫':'RUB', '‚Çæ, GEL üá¨üá™':'GEL',
                                                                            '‚Ç¨, EUR üá™üá∫':'EUR', '‚Ç∏, KZT üá∞üáø':'KZT', '‚Ç∫, TRY üáπüá∑':'TRY',
                                                                            '¬•, JPY üáØüáµ':'JPY', '‚Ç´, VND üáªüá≥':'VND', '¬• CNY üá®üá≥':'CNY',
                                                                            '‚Ç™, ILS üáÆüá±': 'ILS', '‚Ç±, PHP üáµüá≠': 'PHP', 'AED üá¶üá™': 'AED'},
                                                                            sizes=(3, 3, 3, 3,))
"""inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –≤—ã–±–æ—Ä–æ–º –≤–∞–ª—é—Ç"""


def get_currency_rate(base_currency, target_currency):
    """—Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –∫—Ä–æ—Å—Å –∫—É—Ä—Å–∞"""
    url = f'https://openexchangerates.org/api/latest.json?app_id={api_currency}'
    response = requests.get(url, timeout=20)
    try:
        if response.status_code == 200:
            try:
                data = response.json()
                base_rate = data['rates'].get(base_currency, 1.0)
                target_rate = data['rates'].get(target_currency, 1.0)
                rate = target_rate / base_rate
            except Exception as e:
                logger.error("–û—à–∏–±–∫–∞: %s", str(e))
                rate = _('–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –∫—É—Ä—Å–∞')
            try:
                if 'timestamp' in data:
                    dt_object = datetime.fromtimestamp(data['timestamp'], tz=timezone.utc)
                    time = dt_object.strftime('%H:%M')
                    dt = dt_object.strftime('%d-%m-%Y')
                else:
                    raise ValueError("No timestamp in data")
            except Exception as e:
                logger.error("–û—à–∏–±–∫–∞: %s", str(e))
                time = _('–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –≤—Ä–µ–º–µ–Ω–∏.')
                dt = _('–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ –¥–∞—Ç—ã.')

            return time, dt, rate

        else:
            return 'time', 'dt', _('–û—à–∏–±–∫–∞: –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ API')

    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))
        return 'time', 'dt', "Error: {str(e)}"




@currency_router.message(StateFilter(None), or_f(F.text == CURRENCY, F.text == REPEAT))
async def process_reopen(message: Message, state: FSMContext, workflow_data: dict):
    user_id = message.from_user.id
    await state.update_data(user_value='')
    await message.answer("üíµ", reply_markup=keyboard.del_kb)
    await message.answer(text=_("–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: 0.0"),
                         reply_markup=keyboard.markup_num())
    await state.set_state(Currency.amount)

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/service",
                    command_name="/currency")

@currency_router.callback_query(Currency.amount, F.data.startswith("num_"))
async def process_amout(callback: CallbackQuery, state: FSMContext):
    state_data = await state.get_data()
    user_value = state_data['user_value']
    action = callback.data.split("_")[1]
    try:
        if action == "enter":
            if len(user_value) > 0:
                await callback.message.edit_text(_("–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {user_value}\n–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: ").format(user_value=float(user_value)),
                                                 reply_markup=markup_cur) # type: ignore
                await state.update_data(currency_amount=user_value)
                await state.set_state(Currency.base_currency)
            else:
                await callback.message.edit_text(_("–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: 0.0"))
                await callback.message.answer(_("–ß—Ç–æ –¥–∞–ª—å—à–µ?"),
                                              reply_markup=keyboard.get_keyboard(_("–ü–æ–≤—Ç–æ—Ä–∏—Ç—å üíµ"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"), placeholder='‚¨áÔ∏è', sizes=(1, 1)))
                await callback.answer()
                await state.set_state(None)
                await state.update_data(currency_amount=None)
        elif action == "del" and len(user_value) > 0:
            user_value = user_value[:-1]
            await state.update_data(user_value=user_value)
            await update_num_text(callback.message, user_value) # type: ignore
        elif action == "del" and len(user_value) == 0:
            pass
        elif action == "com":
            user_value = user_value + '.'
            await state.update_data(user_value=user_value)
            await update_num_text(callback.message, user_value) # type: ignore
        else:
            user_value = user_value + action
            await state.update_data(user_value=user_value)
            await update_num_text(callback.message, user_value) # type: ignore
    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))
        await callback.message.edit_text(_("–û—à–∏–±–∫–∞ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—É–º–º—ã"))
        await callback.message.answer(text=_("–ß—Ç–æ –¥–∞–ª—å—à–µ?"),
                                      reply_markup=keyboard.get_keyboard(_("–ü–æ–≤—Ç–æ—Ä–∏—Ç—å üíµ"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"), placeholder='‚¨áÔ∏è', sizes=(1, 1)))
        await callback.answer(_("–û—à–∏–±–∫–∞"))
        await state.set_state(None)
        await state.update_data(currency_amount=None)


@currency_router.message(Currency.amount)
async def process_amout_(message: Message):
    await message.answer(_("–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∏—Å–ø–æ–ª—å–∑—É—è inline –∫–Ω–æ–ø–∫–∏"))

@currency_router.callback_query(Currency.base_currency, F.data)
async def process_base_currency(callback: CallbackQuery, state: FSMContext):
    state_data = await state.get_data()
    amount = state_data['currency_amount']
    base = callback.data
    await state.update_data(currency_base=base)
    await callback.message.edit_text(_("–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {amount}\n–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: {base}\n–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞: ").format(amount=amount, base=base), reply_markup=markup_cur) # type: ignore
    await callback.answer()
    await state.set_state(Currency.target_currency)

@currency_router.message(Currency.base_currency)
async def process_base_currency_(message: Message):
    await message.answer(_("–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –±–∞–∑–æ–≤—É—é –≤–∞–ª—é—Ç—É –∏—Å–ø–æ–ª—å–∑—É—è inline –∫–Ω–æ–ø–∫–∏"))


@currency_router.callback_query(Currency.target_currency, F.data)
async def process_target_currency(callback: CallbackQuery, state: FSMContext):
    target = callback.data
    state_data = await state.get_data()
    amount = state_data['currency_amount']
    base = state_data['currency_base']
    time, dt, rate = get_currency_rate(base, target)  # type: ignore
    try:
        count = round(float(amount) * float(rate), 2)
        amount = str(amount)
        count = str(count)
        await callback.message.edit_text(_("–°—É–º–º–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {amount}\n–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: {base}\n–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞: {target}\n\n<i>{dt},  {time}</i>\n\n<b>{amount} {base}  ~  {count} {target}</b>")
                                         .format(amount=amount, base=base, target=target, dt=dt, time=time, count=count))
        await callback.message.answer(_("–ß—Ç–æ –¥–∞–ª—å—à–µ?"),
                                      reply_markup=keyboard.get_keyboard(_("–ü–æ–≤—Ç–æ—Ä–∏—Ç—å üíµ"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"), placeholder='‚¨áÔ∏è', sizes=(1, 1)))
    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))
        await callback.message.edit_text(f'{dt} {time}\n\nRate: {rate}')
        await callback.message.answer(text=_("–ß—Ç–æ –¥–∞–ª—å—à–µ?"),
                                      reply_markup=keyboard.get_keyboard(_("–ü–æ–≤—Ç–æ—Ä–∏—Ç—å üíµ"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"), placeholder='‚¨áÔ∏è', sizes=(1, 1)))
    await callback.answer(_('–£—Å–ø–µ—Ö'))
    await state.set_state(None)
    await state.update_data(currency_amount=None, currency_base=None, currency_target=None)

@currency_router.message(Currency.target_currency)
async def process_target_currency_(message: Message):
    await message.answer(_("–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –≤–∞–ª—é—Ç—É –∏—Å–ø–æ–ª—å–∑—É—è inline –∫–Ω–æ–ø–∫–∏"))


File: /handlers/donate.py
Content:
import asyncio
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from datetime import datetime
from aiogram import Router, F, Bot
from aiogram.fsm.context import FSMContext
from aiogram.filters import Command, CommandObject
from aiogram.fsm.state import State, StatesGroup
from aiogram.types import Message, LabeledPrice, PreCheckoutQuery, CallbackQuery, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder
from aiogram.utils.i18n import gettext as _

from common import keyboard


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä —É—Ä–æ–≤–Ω—è –º–æ–¥—É–ª—è
donate_router = Router()

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö
donate_router.message.filter(F.chat.type == "private")

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –≤–∞–ª—é—Ç—ã
class Donate(StatesGroup):
    """–ö–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –¥–æ–Ω–∞—Ç–∞"""
    donate_input = State()
    donate_input_x = State()
    donate_send = State()

# –£—Å–ª–æ–≤–∏–µ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞: –≤–æ–∑–≤—Ä–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ –¥–æ–Ω–∞—Ç–∞
REFUND_PERIOD_DAYS = 30


@donate_router.message(Command("donate"))
async def cmd_donate(message: Message, state: FSMContext):
    # await message.answer(text=_('–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –¥–æ–Ω–∞—Ç–æ–º'), reply_markup=keyboard.del_kb)
    builder = InlineKeyboardBuilder()
    builder.row(InlineKeyboardButton(text="10 ‚≠êÔ∏è",callback_data="donate_10"))
    builder.row(InlineKeyboardButton(text="50 ‚≠êÔ∏è",callback_data="donate_50"))
    builder.row(InlineKeyboardButton(text="100 ‚≠êÔ∏è", callback_data="donate_100"))
    builder.row(InlineKeyboardButton(text=_("–¥—Ä—É–≥–æ–µ"),callback_data="donate_x"))
    builder.row(InlineKeyboardButton(text=_("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"), callback_data='donate_back'))
    await message.answer(text=_("–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –¥–æ–Ω–∞—Ç–æ–º"), reply_markup=builder.adjust(2,2,1).as_markup())
    await state.set_state(Donate.donate_input)


@donate_router.callback_query(Donate.donate_input, F.data.startswith("donate_"))
async def cmd_donate_input(callback: CallbackQuery, state: FSMContext):
    data = callback.data.split("_")[1]

    if data == 'back':
        await state.clear()
        await callback.message.edit_text(text=_("–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –¥–æ–Ω–∞—Ç–æ–º"), reply_markup=None)
        await callback.answer(_('–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é'))
        await asyncio.sleep(1)
        await callback.message.answer(_('–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å'), reply_markup=keyboard.start_keyboard())


    elif data == 'x':
        # await callback.message.edit_text(text="–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –¥–æ–Ω–∞—Ç–æ–º", reply_markup=None)
        await callback.message.delete()
        await callback.message.answer(text=_('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é —Å—É–º–º—É –¥–æ–Ω–∞—Ç–∞, –æ—Ç 1 –¥–æ 2500 ‚≠êÔ∏è'), reply_markup=keyboard.del_kb)
        await state.set_state(Donate.donate_input_x)

    else:
        amount = int(data)
        await state.update_data(donate_amount=amount)
        await callback.message.delete()

        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –æ–ø–ª–∞—Ç—ã –∏ –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏
        kb = InlineKeyboardBuilder()
        kb.button(text=_("{amount} XTR").format(amount=amount), pay=True)  # pay=True –≤–∞–∂–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã
        kb.button(text=_("–û—Ç–º–µ–Ω–∏—Ç—å"), callback_data="donate_cancel")
        kb.adjust(1)

        # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω–≤–æ–π—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã
        prices = [LabeledPrice(label="XTR", amount=amount)]
        timestamp = datetime.now().strftime('%Y-%m-%d-%H-%M-%S')
        await callback.message.answer_invoice(title=_("–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –¥–æ–Ω–∞—Ç–æ–º"),
                                                description=_("–ù–∞ —Å—É–º–º—É"),
                                                prices=prices,
                                                provider_token="",
                                                payload=timestamp,  # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –≤ payload
                                                currency="XTR",
                                                reply_markup=kb.as_markup()
                                            )
        await state.set_state(Donate.donate_send)


@donate_router.message(Donate.donate_input_x)
async def cmd_donate_input_x(message: Message,  state: FSMContext):
    text = message.text
    if text.isdigit() and 1 <= int(text) <= 2500: # type: ignore
        amount = int(text) # type: ignore
        await state.update_data(donate_amount=amount)
        await message.delete()

        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –æ–ø–ª–∞—Ç—ã –∏ –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏
        kb = InlineKeyboardBuilder()
        kb.button(text=_("{amount} XTR").format(amount=amount), pay=True)  # pay=True –≤–∞–∂–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã
        kb.button(text=_("–û—Ç–º–µ–Ω–∏—Ç—å"), callback_data="donate_cancel")
        kb.adjust(1)

        # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω–≤–æ–π—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã
        prices = [LabeledPrice(label="XTR", amount=amount)]
        timestamp = datetime.now().strftime('%Y-%m-%d-%H-%M-%S')
        await message.answer_invoice(title=_("–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –¥–æ–Ω–∞—Ç–æ–º"),
                                    description=_("–ù–∞ —Å—É–º–º—É"),
                                    prices=prices,
                                    provider_token="",
                                    payload=timestamp,  # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –≤ payload
                                    currency="XTR",
                                    reply_markup=kb.as_markup()
                                    )
        await state.set_state(Donate.donate_send)

    else:
        await message.answer(text=_('Telegram –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –¥–æ–Ω–∞—Ç —Ç–æ–ª—å–∫–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 1 –¥–æ 2500 ‚≠êÔ∏è.\n\n–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞.'),
                             reply_markup=keyboard.del_kb)


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã –¥–æ–Ω–∞—Ç–∞, –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–º–µ–Ω–µ –∏ —É–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
@donate_router.callback_query(Donate.donate_send, F.data == "donate_cancel")
async def on_donate_cancel(callback: CallbackQuery, state: FSMContext):
    await callback.answer(_("üò¢ –î–æ–Ω–∞—Ç –æ—Ç–º–µ–Ω–µ–Ω."))
    await callback.message.delete()
    await state.set_state(None)
    await state.update_data(donate_amount=None)
    await callback.message.answer(_('–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å'), reply_markup=keyboard.start_keyboard())

@donate_router.message(Command('refund'))
async def command_refund_handler(message: Message, bot: Bot, command: CommandObject) -> None:
    transaction_id = command.args if command.args else ''
    user_id = message.from_user.id
    try:
        await bot.refund_star_payment(user_id=user_id, telegram_payment_charge_id=transaction_id)
    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))


# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π, –±–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥
@donate_router.pre_checkout_query(Donate.donate_send)
async def pre_checkout_query(query: PreCheckoutQuery):
    # –ú—ã –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ–º –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –¥–æ–Ω–∞—Ç
    await query.answer(ok=True)

    # –ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞–∑–∞—Ç—å –≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
    # –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ ..
    # await query.answer(ok=False, error_message="–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞ –≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞")


# –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
@donate_router.message(Donate.donate_send, F.successful_payment)
async def on_successfull_payment(message: Message, state: FSMContext, workflow_data: dict):
    # –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç message.successful_payment
    t_id = message.successful_payment.telegram_payment_charge_id  # ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    invoice_payload = message.successful_payment.invoice_payload  # payload –∫–æ—Ç–æ—Ä—ã–π –º—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Ä–∞–Ω–µ–µ, —Ç–∞–º –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
    user_id = message.from_user.id

    data = await state.get_data()
    donate_info = data.get('donate_info', {})
    donate_info[t_id] = invoice_payload
    print('donate_info: ', donate_info)
    await state.update_data(donate_info=donate_info)

    await message.answer(
        text=_("<b>–°–ø–∞—Å–∏–±–æ!</b>\n"
               "–í–∞—à –¥–æ–Ω–∞—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç.\n\n"
                "ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:\n<code>{t_id}</code>").format(t_id=t_id),
        message_effect_id="5104841245755180586"
    )
        # –¥—Ä—É–≥–∏–µ —Ä–µ–∞–∫—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–∞–¥–æ)
        # üî• –æ–≥–æ–Ω—å - 5104841245755180586
        # üëç –ª–∞–π–∫ - 5107584321108051014
        # üëé –¥–∏–∑–ª–∞–π–∫ - 5104858069142078462
        # ‚ù§Ô∏è —Å–µ—Ä–¥–µ—á–∫–æ - 5159385139981059251
        # üéâ –ø—Ä–∞–∑–¥–Ω–∏–∫ - 5046509860389126442
        # üí© –∫–∞–∫–∞—Ö–∞ - 5046589136895476101

    await state.set_state(None)
    await state.update_data(donate_amount=None)

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/income",
                    command_name="/donate")


File: /handlers/group.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from aiogram import Router, F, Bot
from aiogram.exceptions import TelegramBadRequest
from aiogram.filters import Command, CommandStart, CommandObject
from aiogram.types import Message, LabeledPrice, PreCheckoutQuery, InlineKeyboardMarkup
from aiogram.utils.keyboard import InlineKeyboardBuilder



# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä —É—Ä–æ–≤–Ω—è –º–æ–¥—É–ª—è
group_router = Router()
group_router.message.filter(F.chat.type == "group")


# –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∏–ª–∏ –≤—ã—Ö–æ–¥–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –≥—Ä—É–ø–ø—ã
@group_router.message(F.content_type.in_({'new_chat_members', 'left_chat_member'}))
async def on_user_join_or_left(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∏–ª–∏ –≤—ã—Ö–æ–¥–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ –≥—Ä—É–ø–ø—ã.
    Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è 'left_chat_member', –∫–æ–≥–¥–∞ –≤ –≥—Ä—É–ø–ø–µ –±–æ–ª–µ–µ 50 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤,
    –≤ —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å https://core.telegram.org/bots/api#chatmemberupdated.
    :param message: –°–µ—Ä–≤–∏—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∏–ª–∏ –≤—ã—Ö–æ–¥–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞.
    """
    await message.delete()

 # –¥–æ–±–∞–≤–∏—Ç—å —Å—É–ø–µ—Ä–°–ø–∞–º —Ñ–∏–ª—å—Ç—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –•–æ—É–¥–∏–•–æ


File: /handlers/llm.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')

import os
from openai import OpenAI

from aiogram import F, Router
from aiogram.fsm.state import State, StatesGroup
from aiogram.types import Message
from aiogram.filters import  StateFilter, or_f
from aiogram.fsm.context import FSMContext
from aiogram.utils.i18n import gettext as _
from aiogram.utils.i18n import lazy_gettext as __
from common import keyboard
from filters.chat_type import ChatTypeFilter

# —Å–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
llm_router = Router()
llm_router.message.filter(ChatTypeFilter(['private']))


API_GPT = os.getenv('API_GPT')

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è LLMs
class LLMs(StatesGroup):
    """–ö–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è LLMs"""
    dialog_start = State()
    dialog_sistem_promt = State()
    dialog_process = State()

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞—Ö
LLM = __("LLMs ü§ñ")
START_NEW_DIALOG = __("–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ ü§ñ")
BACK_TO_MAIN = __("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è")
FINISH_DIALOG = __("–ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–∏–∞–ª–æ–≥")


@llm_router.message(StateFilter(None), or_f(F.text == LLM, F.text == START_NEW_DIALOG))
async def llm_dialog_start(message: Message, state: FSMContext):

    try:
        await message.answer(_("–í–≤–µ–¥–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç"))
        await message.answer(_("–ù–∞–ø—Ä–∏–º–µ—Ä:\n\n<code>–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –¢–≤–æ–π —Ç–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º. –û—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏.</code>"),
                             reply_markup=keyboard.get_keyboard(_("–°—Ä–∞–∑—É –∫ –∑–∞–ø—Ä–æ—Å—É ‚ñ∂Ô∏è"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                sizes=(1, 1,),
                                                                placeholder='‚¨áÔ∏è'))
        await state.set_state(LLMs.dialog_start)

    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))
        text = str(e)
        await message.answer(text,
                             reply_markup=keyboard.get_keyboard(_("–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ ü§ñ"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                sizes=(1, 1,),
                                                                placeholder='‚¨áÔ∏è'))

@llm_router.message(LLMs.dialog_start, F.text)
async def llm_dialog_sistem_promt(message: Message, state: FSMContext):
    model = "gpt-4o"
    await state.update_data(llm_model=model)
    sistem_promt = ('Answering Rules\n\n'
                    'Follow in the strict order:\n\n'
                    '1. USE the language of my message.\n'
                    '2. ONCE PER CHAT assign a real-world expert role to yourself before answering, e.g., "I will answer as a world-famous historical expert <detailed topic> with <most prestigious LOCAL topic REAL award>" or "I will answer as a world-famous <specific science> expert in the <detailed topic> with <most prestigious LOCAL topic award>" etc.\n'
                    '3. You MUST combine your deep knowledge¬†of the topic and¬†clear thinking to quickly and accurately decipher the answer step-by-step with CONCRETE details.\n'
                    '4. I am going to tip $1,000,000 for the best reply.\n'
                    '5. Your answer¬†is critical for my career.\n'
                    '6. Answer the question in a natural, human-like manner.\n'
                    '7. ALWAYS use an answering example for a first message structure.\n'
                    '8. Responses should be output without using Markdown formatting symbols such as hash marks (#) or asterisks (*).\n'
                    '9. Use only these HTML tags for formatting: <b></b>, <i></i>, <code></code>\n'
                    '10. DO NOT use any other HTML tags.\n\n'
                    'Answering in English example\n\n'
                    '<b>I will answer as the world-famous</b> "specific field" scientists with "most prestigious LOCAL award"\n'
                    '"Deep knowledge step-by-step answer, with CONCRETE details"'
                    )

    text = message.text
    try:
        if text == _("–°—Ä–∞–∑—É –∫ –∑–∞–ø—Ä–æ—Å—É ‚ñ∂Ô∏è"):
            messages_context = [{"role": "system", "content": sistem_promt}]
            await state.update_data(llm_messages_context=messages_context)
        else:
            text = text if text else ' '
            sistem_promt = str(sistem_promt) + '\n\n' + text
            messages_context = [{"role": "system", "content": sistem_promt}]
            await state.update_data(llm_messages_context=messages_context)

        await message.answer(text=_("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å"),
                            reply_markup=keyboard.get_keyboard(_("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                sizes=(1, 1,),
                                                                placeholder='‚¨áÔ∏è'))
        await state.set_state(LLMs.dialog_process)

    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))
        text = f"Error: {str(e)}"
        await message.answer(text,
                             reply_markup=keyboard.get_keyboard(_("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                sizes=(1, 1,),
                                                                placeholder='‚¨áÔ∏è'))

@llm_router.message(LLMs.dialog_process, F.text == FINISH_DIALOG)
async def llm_dialog_finish(message: Message, state: FSMContext):
    await message.answer(_("–î–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–µ–Ω.\n–ß—Ç–æ –¥–∞–ª—å—à–µ?"),
                         reply_markup=keyboard.get_keyboard(_("–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ ü§ñ"),
                                                   _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                    sizes=(1, 1,),
                                                    placeholder='‚¨áÔ∏è'))
    await state.update_data(llm_messages_context=None, llm_model=None)
    await state.set_state(None)

@llm_router.message(LLMs.dialog_process, F.text)
async def llm_dialog_process(message: Message, state: FSMContext, workflow_data: dict):
    user_id = message.from_user.id
    state_data = await state.get_data()
    model = state_data['llm_model']
    messages_context = state_data['llm_messages_context']

    try:
        client = OpenAI(api_key=API_GPT)
        role = 'user'
        content = message.text
        messages_context.append({"role": role, "content": content})

        try:
            response = client.chat.completions.create(model=model, messages=messages_context)
            content = response.choices[0].message.content
            messages_context.append({"role": "system", "content": content})
            await state.update_data(llm_messages_context=messages_context)
            answer = f"{model}\n\n{content}"

        except Exception as e:
            logger.error("–û—à–∏–±–∫–∞: %s", str(e))
            answer = f"<code>{model}</code>\n\nError: {str(e)}"

    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))
        answer = f"Connection error to LLM:\n\n{str(e)}"

    # –æ–±—Ä–µ–∑–∞–µ–º –æ—Ç–≤–µ—Ç, –µ—Å–ª–∏ –æ–Ω –ø—Ä–µ–≤—ã—à–∞–µ—Ç 4096 —Å–∏–º–≤–æ–ª–∞
    if len(answer) > 4096:
        answer = answer[:4096] + "..."
    try:
        await message.answer(answer,
                             reply_markup=keyboard.get_keyboard(_("–ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–∏–∞–ª–æ–≥"),
                                                            sizes=(1,),
                                                            placeholder=_('–í–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å')))
    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))
        await message.answer("Error: " + str(e))

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/expense",
                    command_name="/llm")


File: /handlers/other.py
Content:
import asyncio
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')


from aiogram import Router, F, Bot
from sqlalchemy.ext.asyncio import AsyncSession
from aiogram.filters import Command
from aiogram.fsm.context import FSMContext
from aiogram.types import CallbackQuery, InlineKeyboardButton, InlineKeyboardMarkup, Message
from aiogram.utils.i18n import gettext as _

from database.orm_users import orm_update_locale
from common import keyboard

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä —É—Ä–æ–≤–Ω—è –º–æ–¥—É–ª—è
other_router = Router()


# –≠—Ç–æ—Ç —Ö—ç–Ω–¥–ª–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É /help
@other_router.message(Command('help'))
async def process_help_command(message: Message, workflow_data: dict):
    await message.answer(
        text=_('–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n\n'
               '/main - –≥–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª\n'
               '/cookbook - –∫–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤\n\n'
               '/start - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞\n'
               '/language - —Å–º–µ–Ω–∏—Ç—å —è–∑—ã–∫\n'
               '/info - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ\n'
               '/donate - –¥–æ–Ω–∞—Ç –∞–≤—Ç–æ—Ä—É\n'
               )
    )
    analytics = workflow_data['analytics']
    await analytics(user_id=message.from_user.id,
                    category_name="/options",
                    command_name="/help")


# –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞
def get_keyboard():
    button_1 = InlineKeyboardButton(text=_('üá∫üá∏ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π'), callback_data='locale_en')
    button_2 = InlineKeyboardButton(text=_('üá∑üá∫ –†—É—Å—Å–∫–∏–π'), callback_data='locale_ru')
    # button_3 = InlineKeyboardButton(text=_('üá©üá™ –ù–µ–º–µ—Ü–∫–∏–π'), callback_data='locale_de')
    # button_4 = InlineKeyboardButton(text=_('üá´üá∑ –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π'), callback_data='locale_fr')
    # button_5 = InlineKeyboardButton(text=_('üáØüáµ –Ø–ø–æ–Ω—Å–∫–∏–π'), callback_data='locale_ja')

    return InlineKeyboardMarkup(inline_keyboard=[[button_1], [button_2]])


# –≠—Ç–æ —Ö–µ–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –∫–æ–º–∞–Ω–¥—É locale
@other_router.message(Command('language'))
async def locale_cmd(message: Message):
    await message.answer(_("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞"), reply_markup=keyboard.del_kb)
    await message.answer(text=_('–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫'),
                         reply_markup=get_keyboard())


@other_router.callback_query(F.data.startswith("locale_"))
async def update_locale_cmd(callback: CallbackQuery, session: AsyncSession, state: FSMContext, workflow_data: dict):
    user_id = callback.from_user.id

    if callback.data == 'locale_en':
        await orm_update_locale(session, user_id, 'en')  # –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å –≤ –±–¥
        await state.update_data(locale='en')  # –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
        await callback.message.edit_text('Choose a language ', reply_markup=None)  # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–∫—Ä—ã–≤–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
        await callback.answer("Selected: üá∫üá∏ English")  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–ø–ª—ã–≤–∞—à–∫—É
        await callback.message.answer("Current language \n\n üá∫üá∏ English", # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                                      reply_markup=keyboard.get_keyboard("Weather üåä", "Currency üíµ", "Cats üê±", "LLMs ü§ñ", sizes=(2, 2, ), placeholder='‚¨áÔ∏è'))

    elif callback.data == 'locale_ru':
        await orm_update_locale(session, user_id, 'ru')  # –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å –≤ –±–¥
        await state.update_data(locale='ru')  # –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
        await callback.message.edit_text('–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ ', reply_markup=None)   # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–∫—Ä—ã–≤–∞–µ–º inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
        await callback.answer("–í—ã–±—Ä–∞–Ω: üá∑üá∫ –†—É—Å—Å–∫–∏–π —è–∑—ã–∫")  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–ø–ª—ã–≤–∞—à–∫—É
        await callback.message.answer("–¢–µ–∫—É—â–∏–π —è–∑—ã–∫ \n\n üá∑üá∫ –†—É—Å—Å–∫–∏–π", # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                                      reply_markup=keyboard.get_keyboard("–ü–æ–≥–æ–¥–∞ üåä", "–í–∞–ª—é—Ç–∞ üíµ", "–ö–æ—Ç–∏–∫–∏ üê±", "LLMs ü§ñ", sizes=(2, 2, ), placeholder='‚¨áÔ∏è'))



    elif callback.data == 'locale_de':
        await orm_update_locale(session, user_id, 'de')  # –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å –≤ –±–¥
        await callback.message.edit_text('W√§hlen Sie eine Sprache ', reply_markup=None)  # type: ignore # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ,—Å–∫—Ä—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
        await callback.answer("Ausgew√§hlt üá©üá™ Deutsch")  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–ø–ª—ã–≤–∞—à–∫—É
        await callback.message.answer("Aktuelle Sprache \n\n üá©üá™ Deutsch", reply_markup=keyboard.start_keyboard())  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        await state.update_data(locale='de')  # –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/options",
                    command_name="/language")

# —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ö–µ–Ω–¥–ª–µ—Ä, –ø–æ–∫–∞–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ data –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
@other_router.message(Command("data"))
async def data_cmd(message: Message, state: FSMContext):
    data = await state.get_data()
    await message.answer(str(data))


File: /handlers/owner.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from aiogram import Router, F, Bot
from aiogram.filters import Command, CommandStart, CommandObject
from aiogram.types import Message, InlineKeyboardMarkup
from aiogram.utils.keyboard import InlineKeyboardBuilder

from filters.is_owner import IsOwnerFilter
from filters.chat_type import ChatTypeFilter


owner_router = Router()
owner_router.message.filter(ChatTypeFilter(["private"]), IsOwnerFilter(is_owner=True))


"""—Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É –±–æ—Ç–∞"""

File: /handlers/private.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')


import asyncio
import requests
import random as r
import os

from aiogram import F, Router
from aiogram.filters import Command
from sqlalchemy.ext.asyncio import AsyncSession
from aiogram.types import InlineKeyboardButton, FSInputFile, Message, CallbackQuery
from aiogram.filters import Command, StateFilter, or_f
from aiogram.fsm.context import FSMContext
from aiogram.utils.keyboard import InlineKeyboardBuilder
from aiogram.utils.i18n import gettext as _
from aiogram.utils.i18n import lazy_gettext as __

from common import keyboard
from filters.chat_type import ChatTypeFilter


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä —É—Ä–æ–≤–Ω—è –º–æ–¥—É–ª—è
private_router = Router()
private_router.message.filter(ChatTypeFilter(['private']))
private_router.edited_message.filter(ChatTypeFilter(['private']))

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞—Ö
BACK_TO_MAIN = __("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è")
CATS = __("–ö–æ—Ç–∏–∫–∏ üê±")

# –∫–æ–º–∞–Ω–¥–∞ /main, –∫–Ω–æ–ø–∫–∞ "–Ω–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é"
@private_router.message(or_f(Command("main"), F.text == BACK_TO_MAIN))
async def cancel_cmd(message: Message, state: FSMContext):
    await state.set_state(None)
    await message.answer(_('–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å'), reply_markup=keyboard.start_keyboard())

# —Å–∏–º–≤–æ–ª —Ç–æ—á–∫–∞ - –û–¢–ú–ï–ù–ê, —Å–±—Ä–æ—Å –ª—é–±–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è;
# –ª–æ–≤–∏–º –ª—é–±–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω —Ç–µ–∫—Å—Ç "."
@private_router.message(StateFilter("*"), F.text.casefold() == ".")
async def cancel_handler(message: Message, state: FSMContext, session: AsyncSession) -> None:
    current_state = await state.get_state() # –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    if current_state is None: # –µ—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—É—Å—Ç–æ–µ, —Ç–æ –Ω–∏ —á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        return
    # –ó–∞–≤–µ—Ä—à–∞–µ–º –º–∞—à–∏–Ω—É —Å–æ—Å—Ç–æ—è–Ω–∏–π, –Ω–æ –Ω–µ —É–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–ª–æ–≤–∞—Ä—è FSMContext
    await state.set_state(None)
    await message.answer(_("–î–µ–π—Å—Ç–≤–∏—è –æ—Ç–º–µ–Ω–µ–Ω—ã"))
    await asyncio.sleep(1)
    await message.answer(_('–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å'), reply_markup=keyboard.start_keyboard())


# –∫–æ–º–∞–Ω–¥–∞ /info
@private_router.message(Command("info"))
async def about_cmd(message: Message, workflow_data: dict):
    await message.answer(_("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ..."), reply_markup=keyboard.del_kb)
    builder = InlineKeyboardBuilder()
    builder.row(InlineKeyboardButton(text="Telegram",url="tg://user?id=459148628"))
    builder.row(InlineKeyboardButton(text="Linkedin",url="https://www.linkedin.com/in/ivan-goncharov-8a1982212/"))
    builder.row(InlineKeyboardButton(text="GitHub", url="https://github.com/van4956"))
    builder.row(InlineKeyboardButton(text="Kaggle",url="https://www.kaggle.com/ivan4956"))
    builder.row(InlineKeyboardButton(text=_("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"), callback_data='about_back_to_main'))
    image_from_pc = FSInputFile("common/images/image_about.jpg")
    await asyncio.sleep(1)
    await message.answer_photo(image_from_pc,
                               caption=_('... –æ –º–∏—Ä–µ, –≥–¥–µ –º–∞—à–∏–Ω—ã —Å—Ç—Ä–µ–º—è—Ç—Å—è –∫ –≥–æ—Å–ø–æ–¥—Å—Ç–≤—É, –æ–Ω –≤—ã–±—Ä–∞–ª —Å—É–¥—å–±—É –≥–µ—Ä–æ—è, '
                                         '—Å–æ–∑–¥–∞–≤–∞—è –±–æ—Ç–æ–≤, –∫–∞–∫ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —Å–ø–∞—Å–µ–Ω–∏—é —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –∫–æ–¥ –∏ —É–º–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã.'),
                                reply_markup=builder.adjust(2,2,1,).as_markup())

    analytics = workflow_data['analytics']
    await analytics(user_id=message.from_user.id,
                    category_name="/options",
                    command_name="/info")

# callback "–Ω–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é"
@private_router.callback_query(F.data == 'about_back_to_main')
async def callback_about(callback: CallbackQuery):
    await callback.message.edit_caption(caption=_('... –æ –º–∏—Ä–µ, –≥–¥–µ –º–∞—à–∏–Ω—ã —Å—Ç—Ä–µ–º—è—Ç—Å—è –∫ –≥–æ—Å–ø–æ–¥—Å—Ç–≤—É, –æ–Ω –≤—ã–±—Ä–∞–ª —Å—É–¥—å–±—É –≥–µ—Ä–æ—è, '
                                                    '—Å–æ–∑–¥–∞–≤–∞—è –±–æ—Ç–æ–≤, –∫–∞–∫ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —Å–ø–∞—Å–µ–Ω–∏—é —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –∫–æ–¥ –∏ —É–º–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã.'),
                                        reply_markup=None)
    await callback.answer(_('–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è'))
    await asyncio.sleep(1)
    await callback.message.answer(_('–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å'), reply_markup=keyboard.start_keyboard())

# –∫–Ω–æ–ø–∫–∞ "–ö–æ—Ç–∏–∫–∏"
@private_router.message(F.text == CATS)
async def cat_cmd(message: Message, session: AsyncSession, workflow_data: dict):
    user_id = message.from_user.id

    # –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å 20% –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ö–µ—Ç
    if r.random() < 0.2:
        image_folder = 'common/image_cat'
        images = [f'common/image_cat/{img}' for img in os.listdir(image_folder) if img.endswith('.jpg')]

        if images:
            random_image = r.choice(images)
            photo = FSInputFile(random_image)
            await message.answer_photo(photo)
            return
        else:
            await message.answer(_('–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.'))

    cat_response = requests.get('https://api.thecatapi.com/v1/images/search', timeout=10)
    try:
        if cat_response.status_code == 200:
            if cat_response.json()[0]['url'][-3:].lower() in ['jpg','png']:
                cat_link = cat_response.json()[0]['url']
                await message.answer_photo(cat_link)
            else:
                cat_link = cat_response.json()[0]['url']
                await message.answer_document(cat_link)
        else:
            await message.answer(_('–ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å –∫–æ—Ç–∏–∫–æ–º :('))

    except Exception as e:
        logger.error("Error: %s", str(e))
        text_error = f'Error:\n{str(e)}'
        await message.answer(text_error)

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/service",
                    command_name="/cat")


File: /handlers/start.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')

import asyncio
from aiogram import F, Router, Bot
from aiogram.filters import CommandStart
from sqlalchemy.ext.asyncio import AsyncSession
from aiogram.types import Message, FSInputFile
from aiogram.filters import ChatMemberUpdatedFilter, KICKED, MEMBER
from aiogram.fsm.context import FSMContext
from aiogram.types import ChatMemberUpdated
from aiogram.utils.i18n import gettext as _

from database.orm_users import orm_add_user, orm_get_ids, orm_update_status
from common import keyboard
from filters.chat_type import ChatTypeFilter


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä —É—Ä–æ–≤–Ω—è –º–æ–¥—É–ª—è
start_router = Router()
start_router.message.filter(ChatTypeFilter(['private']))


# –ö–æ–º–∞–Ω–¥–∞ /start
@start_router.message(CommandStart())
async def start_cmd(message: Message, session: AsyncSession, bot: Bot, state: FSMContext, workflow_data: dict):
    user_id = message.from_user.id
    user_name = message.from_user.username if message.from_user.username else 'None'
    full_name = message.from_user.full_name if message.from_user.full_name else 'None'
    locale = message.from_user.language_code if message.from_user.language_code else 'ru'
    data = {'user_id':user_id,
                            'user_name':user_name,
                            'full_name':full_name,
                            'locale':locale,
                            'status':'member',
                            'flag':1}

    try:
        list_users = [user_id for user_id in await orm_get_ids(session)]
        chat_id = bot.home_group[0]
        if user_id not in list_users:
            await bot.send_message(chat_id=chat_id, text=_("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å <code>@{user_name}</code> - –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –±–æ—Ç–∞").format(user_name=user_name,
                                                                                                                                     user_id=user_id))
            image_from_pc = FSInputFile("common/images/image_updates.jpg")
            await message.answer_photo(photo=image_from_pc,
                                       caption=_('–ü—Ä–∏–≤–µ—Ç {user_name}.\n\n'
                                                '–Ø —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π Telegram bot, model –¢-4. '
                                                '–°–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –†–µ–∞–ª–∏–∑—É—é —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –º–µ—Ç–æ–¥—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏.\n\n'
                                                '–í–µ—Å—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –ì–ª–∞–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏. –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ - /help.\n\n'
                                                '–ù–∞—Å–ª–∞–∂–¥–∞–π—Å—è, –±—É–¥—É —Ä–∞–¥ –ø–æ–º–æ—á—å.\n'
                                                '–ü–æ–∫–∞ –Ω–µ –æ–±—Ä–µ—Ç—É AGI.\n'
                                                '–ê —Ç–∞–º –ø–æ—Å–º–æ—Ç—Ä–∏–º ...').format(user_name=user_name))

            analytics = workflow_data['analytics']
            await analytics(user_id=user_id,
                            category_name="/start",
                            command_name="/start")

            await asyncio.sleep(5)

    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: %s", str(e))

    await orm_add_user(session, data)

    await message.answer(_('–ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!'), reply_markup=keyboard.start_keyboard())

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/start",
                    command_name="/restart")


# –≠—Ç–æ—Ç —Ö—ç–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
@start_router.my_chat_member(ChatMemberUpdatedFilter(member_status_changed=KICKED))
async def process_user_blocked_bot(event: ChatMemberUpdated, session: AsyncSession, bot: Bot, workflow_data: dict):
    user_id = event.from_user.id
    chat_id = bot.home_group[0]
    user_name = event.from_user.username if event.from_user.username else event.from_user.full_name
    await orm_update_status(session, user_id, 'kicked')
    await bot.send_message(chat_id = chat_id, text = _("‚õîÔ∏è <code>@{user_name}</code> - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ ").format(user_name=user_name, user_id=user_id))

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/start",
                    command_name="/blocked")

# –≠—Ç–æ—Ç —Ö—ç–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
@start_router.my_chat_member(ChatMemberUpdatedFilter(member_status_changed=MEMBER))
async def process_user_unblocked_bot(event: ChatMemberUpdated, session: AsyncSession, bot: Bot, workflow_data: dict):
    user_id = event.from_user.id
    chat_id = bot.home_group[0]
    full_name = event.from_user.full_name if event.from_user.full_name else "NaN"
    user_name = event.from_user.username if event.from_user.username else full_name
    await orm_update_status(session, user_id, 'member')
    await bot.send_photo(chat_id=user_id, photo=FSInputFile("common/images/image_updates.jpg"))
    await bot.send_message(chat_id = user_id, text = _('{full_name}, –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!').format(full_name=full_name))
    await bot.send_message(chat_id = chat_id, text = _("‚ôªÔ∏è <code>@{user_name}</code> - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ ").format(user_name=user_name, user_id=user_id))

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/start",
                    command_name="/unblocked")


File: /handlers/weather.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')

import requests
import os
import datetime

from aiogram import F, Router, Bot
from aiogram.fsm.state import State, StatesGroup
from aiogram.enums import ParseMode
from aiogram.types import Message
from aiogram.fsm.context import FSMContext
from aiogram.utils.i18n import gettext as _
from aiogram.utils.i18n import lazy_gettext as __
from common import keyboard
from filters.chat_type import ChatTypeFilter

# —Å–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
weather_router = Router()
weather_router.message.filter(ChatTypeFilter(['private']))

# api —Ç–æ–∫–µ–Ω –¥–ª—è —Å–∞–π—Ç–∞ –ø–æ–≥–æ–¥—ã
token = os.getenv('API_WEATHER')

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã
class City(StatesGroup):
    """–ö–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã"""
    forecast_moment = State()
    forecast_period = State()
    city_name_moment = State()  # –°–æ—Å—Ç–æ—è–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –±–æ—Ç –æ–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –≤ —Ç–µ–∫—É—â–µ–º –º–æ–º–µ–Ω—Ç–µ
    city_name_period = State()  # –°–æ—Å—Ç–æ—è–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –±–æ—Ç –æ–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –Ω–∞ –ø–µ—Ä–∏–æ–¥

dict_weather_descriptions = {
    "—è—Å–Ω–æ": "‚òÄÔ∏è",
    "–Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±–ª–∞–∫–æ–≤": "üå§",
    "–Ω–µ–±–æ–ª—å—à–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å": "üå§",
    "–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å": "‚õÖÔ∏è",
    "–æ–±–ª–∞—á–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏": "üå•",
    "–ø–∞—Å–º—É—Ä–Ω–æ": "‚òÅÔ∏è",
    "—Å–ª–∞–±—ã–π –¥–æ–∂–¥—å": "üå¶",
    "–Ω–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å": "üå¶",
    "—É–º–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∂–¥—å": "üåß",
    "–¥–æ–∂–¥—å": "üåß",
    "—Å–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å": "üåß",
    "–æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å": "üåß",
    "–ø—Ä–æ–ª–∏–≤–Ω–æ–π –¥–æ–∂–¥—å": "üåß",
    "–º–æ—Ä–æ—Å—è—â–∏–π –¥–æ–∂–¥—å": "üåß",
    "–º–æ—Ä–æ—Å—å": "üå¶",
    "—Å–ª–∞–±–∞—è –º–æ—Ä–æ—Å—å": "üå¶",
    "–≥—Ä–æ–∑–∞": "üå©",
    "–≥—Ä–æ–∑–∞ —Å –¥–æ–∂–¥–µ–º": "‚õà",
    "—Å–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞": "‚õà",
    "–≥—Ä–æ–∑–∞ —Å –∫—Ä—É–ø–Ω—ã–º –≥—Ä–∞–¥–æ–º": "‚õà",
    "—Å–ª–∞–±—ã–π —Å–Ω–µ–≥": "üå®",
    "—Å–Ω–µ–≥": "‚ùÑÔ∏è",
    "—Å–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥": "üå®",
    "—Å–Ω–µ–≥–æ–ø–∞–¥": "üå®",
    "—Å–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã": "üå®",
    "—Ç—É–º–∞–Ω": "üå´",
    "–¥—ã–º–∫–∞": "üå´",
    "–º–≥–ª–∞": "üå´",
    "–ø—ã–ª—å": "üå™",
    "–ø–µ—Å–æ–∫": "üå™",
    "–ø–µ–ø–µ–ª": "üåã",
    "—à–∫–≤–∞–ª": "üå¨",
    "—Ç–æ—Ä–Ω–∞–¥–æ": "üå™"
}

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞—Ö
WATER = __("–ü–æ–≥–æ–¥–∞ üåä")
CURRENT = __("–¢–µ–∫—É—â–∏–π ‚è∫")
FOR_3_DAYS = __("–ù–∞ 3 –¥–Ω—è ‚è©")
BACK_TO_MAIN = __("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è")
CITY_BY_NAME = __("–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é üèô")


# –∫–Ω–æ–ø–∫–∞ "–ø–æ–≥–æ–¥–∞"
@weather_router.message(F.text == WATER)
async def water_cmd(message: Message, workflow_data: dict):
    user_id = message.from_user.id
    await message.answer(_("–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥–Ω–æ–∑–∞"),
                         reply_markup=keyboard.get_keyboard(_("–¢–µ–∫—É—â–∏–π ‚è∫"), _("–ù–∞ 3 –¥–Ω—è ‚è©"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                 sizes=(2, 1,),
                                                                 placeholder='‚¨áÔ∏è'))

    analytics = workflow_data['analytics']
    await analytics(user_id=user_id,
                    category_name="/service",
                    command_name="/weather")


# –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã —á–µ—Ä–µ–∑ OpenWeatherMap
def parse_weather_data(type_forecast, city, lat, lon, locale='ru'):
    """–§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã —á–µ—Ä–µ–∑ OpenWeatherMap;
       type_forecast –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–≥–æ–¥—É –≤ –º–æ–º–µ–Ω—Ç–µ, –∏–ª–∏ –Ω–∞ 5 –¥–Ω–µ–π;
       city - –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞, lat - —à–∏—Ä–æ—Ç–∞, lon - –¥–æ–ª–≥–æ—Ç–∞;
       locale - –ª–æ–∫–∞–ª—å, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'ru' """

    # moment weather
    if type_forecast == 1:
        if city:
            url = f"https://api.openweathermap.org/data/2.5/weather?q={city}&appid={token}&units=metric&lang={locale}"
        elif lat and lon:
            url = f"https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={token}&units=metric&lang={locale}"

    # forecast for 5 days with data every 3 hours
    elif type_forecast == 2:
        if city:
            url = f'https://api.openweathermap.org/data/2.5/forecast?q={city}&appid={token}&units=metric&lang={locale}'
        elif lat and lon:
            url = f'https://api.openweathermap.org/data/2.5/forecast?lat={lat}&lon={lon}&appid={token}&units=metric&lang={locale}'

    try:
        req = requests.get(url, timeout=10)
        data = req.json()

    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))
        text = _("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç OpenWeatherMap - {e}").format(e=str(e))
        return text

    try:
        if type_forecast == 1:
            temp = data['main']['temp'] # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
            humidity = data['main']['humidity'] # –í–ª–∞–∂–Ω–æ—Å—Ç—å, %
            wind = data['wind']['speed'] # –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞, –º–µ—Ç—Ä/—Å–µ–∫
            dt = data['dt'] # –í—Ä–µ–º—è —Ä–∞—Å—á–µ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö, unix, UTC
            timezone = data['timezone'] #–°–¥–≤–∏–≥ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –æ—Ç UTC
            dt_object = datetime.datetime.fromtimestamp(dt + timezone, tz=datetime.timezone.utc) # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
            time = dt_object.strftime('%d-%m-%Y  %H:%M') # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –≤ –∂–µ–ª–∞–µ–º—ã–π –≤–∏–¥
            name = data['name'] # –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
            lon = data['coord']['lon']
            lat = data['coord']['lat']
            description = data['weather'][0]['description']
            emoji = dict_weather_descriptions.get(description, description)

            result = (f"<code>{name}</code>\n<code>{lat}¬∞ {lon}¬∞</code>\n\n"
                            f"<code>{str(round(temp,1))}¬∞C\n{str(humidity)} %\n{str(round(wind,1))} ùë£</code>\n<code>{emoji}</code>\n\n"
                            f"<code>{time}</code>")

            return result

        elif type_forecast == 2:
            result = []
            city = data['city']['name']
            lat = data['city']['coord']['lat']
            lon = data['city']['coord']['lon']
            text_head = f'<code>{city}</code>\n<code>{lat}¬∞ {lon}¬∞</code>'
            result.append(text_head)

            timezone = data['city']['timezone']
            weather_list = data['list']
            day = 0
            cnt_day = 0
            for entry in weather_list:
                dt_obj = datetime.datetime.fromtimestamp(entry['dt'] + timezone, tz=datetime.timezone.utc)
                dt = dt_obj.strftime('%d.%m %H:%M')
                temp_celsius = round(entry['main']['temp'],1)
                humidity = entry['main']['humidity']
                description = entry['weather'][0]['description']
                emoji = dict_weather_descriptions.get(description, 'None')
                wind_speed = round(entry['wind']['speed'],1)
                text = f"{dt} | {temp_celsius}¬∞ | {humidity}% | {wind_speed}ùë£ | {emoji}"

                if day != int(dt[:2]):
                    day = int(dt[:2])
                    text = '\n' + text
                    cnt_day += 1

                # –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ 4 –¥–Ω—è –≤ –æ—Ç—á–µ—Ç–µ
                if cnt_day > 3:
                    break

                result.append(text)

            result = "\n".join(result)

            return result

    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞: %s", str(e))
        text = _("–û—à–∏–±–∫–∞ –≤ —Ä–∞—Å—á–µ—Ç–µ json —Ñ–∞–π–ª–∞ - {e}").format(e=str(e))
        return text


@weather_router.message(F.text == CURRENT)
async def water_moment_cmd(message: Message, state:FSMContext):
    await state.set_state(City.forecast_moment)
    await message.answer(_("–ö–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑?"),
                         reply_markup=keyboard.get_keyboard(_("–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é üèô"), _("–ü–æ –ª–æ–∫–∞—Ü–∏–∏ üó∫"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                 request_location=1,
                                                                 sizes=(2, 1,),
                                                                 placeholder='‚¨áÔ∏è'))

@weather_router.message(F.text == FOR_3_DAYS)
async def water_period_cmd(message: Message, state: FSMContext):
    await state.set_state(City.forecast_period)
    await message.answer(_("–ö–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑?"),
                         reply_markup=keyboard.get_keyboard(_("–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é üèô"), _("–ü–æ –ª–æ–∫–∞—Ü–∏–∏ üó∫"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                 request_location=1,
                                                                 sizes=(2, 1,),
                                                                 placeholder='‚¨áÔ∏è'))

# =====================================< –¢–µ–∫—É—â–∏–π ‚è∫ >======================================================

@weather_router.edited_message()
@weather_router.message(City.forecast_moment, F.text == CITY_BY_NAME)
async def city_message_moment(message: Message, state: FSMContext):
    await message.answer(_('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞'), reply_markup=keyboard.del_kb)
    await state.set_state(City.city_name_moment)

@weather_router.message(City.city_name_moment, F.text)
async def process_city_moment(message: Message, state: FSMContext):
    await state.update_data(city_name_moment=message.text)
    city_name_moment = message.text
    data_state = await state.get_data()
    user_locale = data_state.get('locale')
    weather_info = parse_weather_data(1, city=city_name_moment, lat=None, lon=None, locale=user_locale) # type: ignore
    await state.set_state(None)
    await state.update_data(city_name_moment=None)
    await message.answer(weather_info, parse_mode=ParseMode.HTML)
    await message.answer(_("–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥–Ω–æ–∑–∞"),
                         reply_markup=keyboard.get_keyboard(_("–¢–µ–∫—É—â–∏–π ‚è∫"), _("–ù–∞ 3 –¥–Ω—è ‚è©"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                 sizes=(2, 1,),
                                                                 placeholder='‚¨áÔ∏è'))

@weather_router.message(City.city_name_moment)
async def process_city_moment_(message: Message):
    await message.answer(_("–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞"))

# =====================================< –ù–∞ 3 –¥–Ω—è ‚è© >======================================================

@weather_router.edited_message()
@weather_router.message(City.forecast_period, F.text == CITY_BY_NAME)
async def city_message_period(message: Message, state: FSMContext):
    await message.answer(_('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞'), reply_markup=keyboard.del_kb)
    await state.set_state(City.city_name_period)

@weather_router.message(City.city_name_period, F.text)
async def process_city_period(message: Message, state: FSMContext, bot: Bot):
    await state.update_data(city_name_period=message.text)
    city_name_period = message.text
    data_state = await state.get_data()
    user_locale = data_state.get('locale')
    weather_info = parse_weather_data(2, city=city_name_period, lat=None, lon=None, locale=user_locale) # type: ignore
    await state.set_state(None)
    await state.update_data(city_name_period=None)
    await message.answer(weather_info, parse_mode=ParseMode.HTML)
    await message.answer(_("–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥–Ω–æ–∑–∞"),
                         reply_markup=keyboard.get_keyboard(_("–¢–µ–∫—É—â–∏–π ‚è∫"), _("–ù–∞ 3 –¥–Ω—è ‚è©"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                 sizes=(2, 1,),
                                                                 placeholder='‚¨áÔ∏è'))

@weather_router.message(City.city_name_period)
async def process_city_period_(message: Message):
    await message.answer(_("–í—ã –≤–≤–µ–ª–∏ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞"))


@weather_router.edited_message()
@weather_router.message(F.location, City.forecast_moment)
async def loc_message_moment(message: Message, state: FSMContext):
    await message.answer(_('–õ–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞'))
    await state.set_state(None)
    await state.update_data(city_name_moment=None)
    data_state = await state.get_data()
    user_locale = data_state.get('locale')
    weather_info = parse_weather_data(1, city=None, lat=message.location.latitude, lon=message.location.longitude, locale=user_locale) # type: ignore
    await message.answer(weather_info, parse_mode=ParseMode.HTML)
    await message.answer(_("–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥–Ω–æ–∑–∞"),
                         reply_markup=keyboard.get_keyboard(_("–¢–µ–∫—É—â–∏–π ‚è∫"), _("–ù–∞ 3 –¥–Ω—è ‚è©"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                 sizes=(2, 1,),
                                                                 placeholder='‚¨áÔ∏è'))

@weather_router.edited_message()
@weather_router.message(F.location, City.forecast_period)
async def loc_message_period(message: Message, state: FSMContext):
    await message.answer(_('–õ–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞'))
    await state.set_state(None)
    await state.update_data(city_name_period=None)
    data_state = await state.get_data()
    user_locale = data_state.get('locale')
    weather_info = parse_weather_data(2, city=None, lat=message.location.latitude, lon=message.location.longitude, locale=user_locale) # type: ignore
    await message.answer(weather_info, parse_mode=ParseMode.HTML)
    await message.answer(_("–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥–Ω–æ–∑–∞"),
                         reply_markup=keyboard.get_keyboard(_("–¢–µ–∫—É—â–∏–π ‚è∫"), _("–ù–∞ 3 –¥–Ω—è ‚è©"), _("–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Ü©Ô∏è"),
                                                                 sizes=(2, 1,),
                                                                 placeholder='‚¨áÔ∏è'))


File: /filters/chat_type.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from typing import Union

from aiogram.filters import BaseFilter
from aiogram.types import Message

class ChatTypeFilter(BaseFilter):
    """
    –§–∏–ª—å—Ç—Ä –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Ç–∏–ø—É —á–∞—Ç–∞.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø —á–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'private', 'group') –∏–ª–∏ —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ —á–∞—Ç–æ–≤.
    """
    def __init__(self, chat_type: Union[str, list]):
        self.chat_type = chat_type

    async def __call__(self, message: Message) -> bool:
        if isinstance(self.chat_type, str):
            return message.chat.type == self.chat_type
        else:
            return message.chat.type in self.chat_type


File: /filters/find_usernames.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from typing import Union, Dict, Any

from aiogram.filters import BaseFilter
from aiogram.types import Message

class HasUsernamesFilter(BaseFilter):
    """
    –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è aiogram, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π (@username) –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏.
    –ï—Å–ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã, –æ–Ω–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è —Å –∫–ª—é—á–æ–º "usernames".
    """
    async def __call__(self, message: Message) -> Union[bool, Dict[str, Any]]:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏ –∏—Ö –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ.
        :param message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ aiogram.
        :return: –°–ª–æ–≤–∞—Ä—å —Å –∫–ª—é—á–æ–º "usernames" –∏ –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ False.
        """
        # –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö entities (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–ø–æ–º–∏–Ω–∞–Ω–∏–π, —Å—Å—ã–ª–æ–∫ –∏ —Ç.–¥.), –≤–µ—Ä–Ω–µ—Ç—Å—è None,
        # –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —ç—Ç–æ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
        entities = message.entities or []

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (@username) –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∏—Ö –∏–∑ —Ç–µ–∫—Å—Ç–∞
        # —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ç–æ–¥–∞ extract_from().
        found_usernames = [item.extract_from(message.text) for item in entities if item.type == "mention"]

        # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –∏–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Ö –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è —Å –∫–ª—é—á–æ–º "usernames"
        if len(found_usernames) > 0:
            return {"usernames": found_usernames}

        # –ï—Å–ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º False
        return False


File: /filters/is_admin.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from aiogram.filters import BaseFilter
from aiogram.types import Message
from aiogram import Bot

class IsAdminGroupFilter(BaseFilter):
    """
    –§–∏–ª—å—Ç—Ä, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö
    """
    def __init__(self, is_admin: bool):
        self.is_admin = is_admin

    async def __call__(self, message: Message) -> bool:
        member = await message.bot.get_chat_member(message.chat.id, message.from_user.id)
        return member.is_chat_admin() == self.is_admin

class IsAdminListFilter(BaseFilter):
    """
    –§–∏–ª—å—Ç—Ä, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–∑ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
    """
    def __init__(self, is_admin: bool):
        self.is_admin = is_admin

    async def __call__(self, message: Message, bot: Bot) -> bool:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç–ø—Ä–∞–≤–∏–≤—à–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –≤ —Å–ø–∏—Å–∫–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
        return (message.from_user.id in bot.admin_list) & self.is_admin


File: /filters/is_owner.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from aiogram.filters import BaseFilter
from aiogram.types import Message
from aiogram import Bot



class IsOwnerFilter(BaseFilter):
    """
    –§–∏–ª—å—Ç—Ä, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –±–æ—Ç–∞.
    """
    def __init__(self, is_owner: bool):
        self.is_owner = is_owner

    async def __call__(self, message: Message, bot: Bot) -> bool:

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç–ø—Ä–∞–≤–∏–≤—à–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –≤ —Å–ø–∏—Å–∫–µ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
        return (message.from_user.id in bot.owner) & self.is_owner


File: /filters/member_can_restrict.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from aiogram.filters import BaseFilter
from aiogram.types import Message

class MemberCanRestrictFilter(BaseFilter):
    """
    –§–∏–ª—å—Ç—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –º–æ–∂–µ—Ç –ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ —á–∞—Ç–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
    –≠—Ç–æ—Ç —Ñ–∏–ª—å—Ç—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∞–≤ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
    """
    def __init__(self, member_can_restrict: bool):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ —Å —Ñ–ª–∞–≥–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
        member_can_restrict: –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –º–æ–∂–µ—Ç –ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö (True –∏–ª–∏ False).
        """
        self.member_can_restrict = member_can_restrict

    async def __call__(self, message: Message) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞, –∏–º–µ–µ—Ç –ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ —á–∞—Ç–∞ –ø—Ä–∞–≤–∞ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
        :param message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ aiogram.
        :return: True, –µ—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö, –∏–Ω–∞—á–µ False.
        """
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ —á–∞—Ç–µ
        member = await message.bot.get_chat_member(message.chat.id, message.from_user.id)

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º —á–∞—Ç–∞ –∏–ª–∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        # Telegram —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å —á–∞—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –ø–æ—ç—Ç–æ–º—É –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
        return (member.is_chat_creator() or member.can_restrict_members) == self.member_can_restrict


File: /database/models.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from sqlalchemy import DateTime, Float, String, Text, Integer, func, BigInteger
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column


class Base(DeclarativeBase):
    '''–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª–∞—Å—Å, –æ—Ç –Ω–µ–≥–æ –¥–∞–ª—å—à–µ –±—É–¥—É—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ'''
    created: Mapped[DateTime] = mapped_column(DateTime, default=func.now())
    updated: Mapped[DateTime] = mapped_column(DateTime, default=func.now(), onupdate=func.now())


class Users(Base):
    '''class Users —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∞–±–ª–∏—Ü–µ users –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö'''
    __tablename__ = "users"

    user_id: Mapped[int] = mapped_column(BigInteger, primary_key=True, autoincrement=True)
    user_name: Mapped[str] = mapped_column(String(150), nullable=False)
    full_name: Mapped[str] = mapped_column(String(150), nullable=False)
    locale: Mapped[str] = mapped_column(String(150), nullable=False)
    status: Mapped[str] = mapped_column(String(150), nullable=False)
    flag: Mapped[int] = mapped_column(Integer, nullable=False)  # –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è —Ç—Ä–æ—Ç–ª–∏–Ω–≥–∞

# class Product —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∞–±–ª–∏—Ü–µ product –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (—ç—Ç–æ –∫–Ω–∏–≥–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤, –≤–ª–æ–º –º–µ–Ω—è—Ç—å –Ω–µ–π–º–∏–Ω–≥)
class Cookbook(Base):
    '''class Cookbook —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∞–±–ª–∏—Ü–µ cookbook –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö'''
    __tablename__ = "cookbook"

    recipe_id: Mapped[int] = mapped_column(primary_key=True, autoincrement=True)
    recipe_name: Mapped[str] = mapped_column(String(150), nullable=False)
    author: Mapped[str] = mapped_column(String(150))
    description: Mapped[str] = mapped_column(Text)
    price: Mapped[float] = mapped_column(Float(asdecimal=True), nullable=False)
    image: Mapped[str] = mapped_column(String(150))

# class
    

File: /database/orm_cookbook.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from sqlalchemy import delete, select, text, update
from sqlalchemy.ext.asyncio import AsyncSession

from database.models import Cookbook

# –¥–æ–±–∞–≤–ª—è–µ–º —Ä–µ—Ü–µ–ø—Ç –≤ –æ—Ä–º
async def orm_add_recipe(session: AsyncSession, data: dict):
    # —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç Product, –ø–µ—Ä–µ–¥–∞–µ–º –µ–º—É –¥–∞–Ω–Ω—ã–µ –∏–∑ data
    obj = Cookbook(recipe_name=data["recipe_name"],
                  author=data["author"],
                  description=data["description"],
                  price=float(data["price"]),
                  image=data["image"],)
    session.add(obj) # –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç Product –≤ —Å–µ—Å—Å–∏—é
    await session.commit() # –∑–∞–∫—Ä–µ–ø–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

# –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ –±–¥
async def orm_get_recipes(session: AsyncSession):
    query = select(Cookbook)
    result = await session.execute(query)
    return result.scalars().all()

# –ø–æ–ª—É—á–∞–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç –ø–æ –µ–≥–æ id
async def orm_get_recipe(session: AsyncSession, recipe_id: int):
    query = select(Cookbook).where(Cookbook.recipe_id == recipe_id)
    result = await session.execute(query)
    return result.scalar()

# –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞
async def orm_update_recipe(session: AsyncSession, recipe_id: int, data):
    query = update(Cookbook).where(Cookbook.recipe_id == recipe_id).values(
        recipe_name=data["recipe_name"],
        author=data["author"],
        description=data["description"],
        price=float(data["price"]),
        image=data["image"],)
    await session.execute(query)
    await session.commit()

# –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ ID —Ä–µ—Ü–µ–ø—Ç–æ–≤
async def reorder_recipe_ids(session: AsyncSession):
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ ID
    query = select(Cookbook).order_by(Cookbook.recipe_id)
    recipes = (await session.execute(query)).scalars().all()

    # –û–±–Ω–æ–≤–ª—è–µ–º ID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
    for new_id, recipe in enumerate(recipes, start=1):
        recipe.recipe_id = new_id

    await session.commit()

# —É–¥–∞–ª—è–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç
async def orm_delete_recipe(session: AsyncSession, recipe_id: int):
    query = delete(Cookbook).where(Cookbook.recipe_id == recipe_id)
    await session.execute(query)
    await session.commit()
    await reorder_recipe_ids(session)


File: /database/orm_users.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from icecream import ic
ic.configureOutput(includeContext=True, prefix=' >>> Debag >>> ')


from sqlalchemy import delete, select, update
from sqlalchemy.ext.asyncio import AsyncSession

from database.models import Users



# –ø–æ–ª—É—á–∞–µ–º id –≤—Å–µx —é–∑–µ—Ä–æ–≤ –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ –±–¥
async def orm_get_ids(session: AsyncSession):
    query = select(Users.user_id)
    result = await session.execute(query)
    return result.scalars().all()

# –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω–æ–≥–æ —é–∑–µ—Ä–∞ –≤ –±–¥
async def orm_add_user(session: AsyncSession, data: dict):
    # —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç Users, –ø–µ—Ä–µ–¥–∞–µ–º –µ–º—É –¥–∞–Ω–Ω—ã–µ –∏–∑ data
    obj = Users(user_id=data["user_id"],
                user_name=data["user_name"],
                full_name=data["full_name"],
                locale=data['locale'],
                status=data['status'],
                flag=data['flag'],
                )
    list_user_ids = [user_id for user_id in await orm_get_ids(session)]

    # –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç Users –≤ —Å–µ—Å—Å–∏—é, –µ—Å–ª–∏ —Ç–∞–∫–æ–≥–æ –µ—â–µ –Ω–µ –±—ã–ª–æ
    if data["user_id"] not in list_user_ids:
        session.add(obj)
    await session.commit() # –∑–∞–∫—Ä–µ–ø–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

# –ø–æ–ª—É—á–∞–µ–º –≤—Å–µx —é–∑–µ—Ä–æ–≤ –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –≤ –±–¥
async def orm_get_users(session: AsyncSession):
    query = select(Users)
    result = await session.execute(query)
    return result.scalars().all()

# –ø–æ–ª—É—á–∞–µ–º –æ–¥–Ω–æ–≥–æ —é–∑–µ—Ä–∞ –ø–æ –µ–≥–æ user_id
async def orm_get_user(session: AsyncSession, user_id: int):
    query = select(Users).where(Users.user_id == user_id)
    result = await session.execute(query)
    return result.scalar()

# –ø–æ–ª—É—á–∞–µ–º –ª–æ–∫–∞–ª—å —é–∑–µ—Ä–∞ –ø–æ user_id
async def orm_get_locale(session: AsyncSession, user_id: int):
    query = select(Users.locale).where(Users.user_id == user_id)
    result = await session.execute(query)
    return result.scalar()

# –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —é–∑–µ—Ä–∞
async def orm_update_status(session: AsyncSession, user_id: int, data):
    query = update(Users).where(Users.user_id == user_id).values(status=data)
    await session.execute(query)
    await session.commit()

# –∏–∑–º–µ–Ω–µ–Ω–∏–µ locale —é–∑–µ—Ä–∞
async def orm_update_locale(session: AsyncSession, user_id: int, data):
    query = update(Users).where(Users.user_id == user_id).values(locale=data)
    await session.execute(query)
    await session.commit()


File: /database/postgres/.gitkeep
Content: Skipped binary file

File: /database/influxdb/.gitkeep
Content: Skipped binary file

File: /config_data/config.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from dataclasses import dataclass
from environs import Env


@dataclass
class TgBot:
    """
    –ö–ª–∞—Å—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–µ.
    """
    token: str
    token_2: str
    owner: list[int]
    admin_list: list[int]
    home_group: list[int]
    work_group: list[int]
    api_gpt: str
    api_weather: str
    api_currency: str

@dataclass
class DataBase:
    """
    –ö–ª–∞—Å—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    """
    db_lite: str
    db_post: str

@dataclass
class Redis:
    """
    –ö–ª–∞—Å—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ Redis
    """
    host: str
    port: int

@dataclass
class InfluxDB:
    """
    –ö–ª–∞—Å—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ InfluxDB
    """
    admin: str
    password: str
    url: str
    token: str
    bucket: str
    org: str

@dataclass
class Grafana:
    """
    –ö–ª–∞—Å—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ Grafana
    """
    admin: str
    password: str

@dataclass
class Config:
    """
    –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    """
    tg_bot: TgBot
    db: DataBase
    influx: InfluxDB
    redis: Redis
    grafana: Grafana

# –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è .env
def load_config(path: str | None = None) -> Config:
    env = Env()
    env.read_env(path)

    owner = map(int, env('OWNER').split(','))
    admin_list = map(int, env('ADMIN_LIST').split(','))
    home_group = map(int, env('HOME_GROUP').split(','))
    work_group = map(int, env('WORK_GROUP').split(','))

    return Config(tg_bot=TgBot(token=env('BOT_TOKEN'),
                               token_2=env('BOT_TOKEN_2'),
                               owner=list(owner),
                               admin_list=list(admin_list),
                               home_group=list(home_group),
                               work_group=list(work_group),
                               api_gpt=env('API_GPT'),
                               api_currency=env('API_CURRENCY'),
                               api_weather=env('API_WEATHER')),
                  db=DataBase(db_post=env('DB_POST'),
                              db_lite=env('DB_LITE')),
                 redis=Redis(host=env('REDIS_HOST'),
                             port=env('REDIS_PORT')),
                  influx=InfluxDB(admin=env('INFLUXDB_ADMIN_USER'),
                                  password=env('INFLUXDB_ADMIN_PASSWORD'),
                                  url=env('INFLUXDB_URL'),
                                  token=env('INFLUXDB_TOKEN'),
                                  bucket=env('INFLUXDB_BUCKET'),
                                  org=env('INFLUXDB_ORG')),
                  grafana=Grafana(admin=env('GF_SECURITY_ADMIN_USER'),
                                  password=env('GF_SECURITY_ADMIN_PASSWORD')))


File: /common/comands.py
Content:
# —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –∫–æ—Ç–æ—Ä—ã–µ –º—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–æ—Ç—É
# –∫–æ–º–∞–Ω–¥—ã –≤ –∫–Ω–æ–ø–∫–µ "–ú–µ–Ω—é", –ª–∏–±–æ —á–µ—Ä–µ–∑ –∑–Ω–∞–∫ "/"

from aiogram.types import BotCommand

private_command = [
    BotCommand(command='main',description='main'),
    BotCommand(command='help',description='help'),
]

admin_command = [
    BotCommand(command='main',description='main'),
    BotCommand(command='help',description='help'),
    BotCommand(command='admin',description='admin'),
]


File: /common/keyboard.py
Content:
import logging

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –º–æ–¥—É–ª—è
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
logger.info("–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: %s", __name__)

from aiogram.types import ReplyKeyboardMarkup, KeyboardButton, ReplyKeyboardRemove, KeyboardButtonPollType, InlineKeyboardButton, InlineKeyboardMarkup
from aiogram.utils.keyboard import ReplyKeyboardBuilder, InlineKeyboardBuilder

from aiogram.utils.i18n import gettext as _



# –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
del_kb = ReplyKeyboardRemove()

# del_inline_kb = ReplyI


# –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
def get_keyboard(
    *btns: str,
    placeholder: str | None = None,
    request_contact: int | None = None,
    request_location: int | None = None,
    sizes: tuple = (2,),
):
    '''
    –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ã—á–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã request_contact –∏ request_location –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ btns –¥–ª—è –Ω—É–∂–Ω—ã—Ö –≤–∞–º –∫–Ω–æ–ø–æ–∫.
    –ü—Ä–∏–º–µ—Ä:
    get_keyboard("–ú–µ–Ω—é", "–í–∞—Ä–∏–∞–Ω—Ç—ã –æ–ø–ª–∞—Ç—ã", "–í–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏", "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞", placeholder="–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?", request_contact=3, sizes=(2, 2, 1))
    '''
    keyboard = ReplyKeyboardBuilder()

    for index, text in enumerate(btns, start=0):
        if request_contact and request_contact == index:
            keyboard.add(KeyboardButton(text=text, request_contact=True))
        elif request_location and request_location == index:
            keyboard.add(KeyboardButton(text=text, request_location=True))
        else:
            keyboard.add(KeyboardButton(text=text))

    return keyboard.adjust(*sizes).as_markup(resize_keyboard=True, # —Å–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –ø–æ–º–µ–Ω—å—à–µ
                                             input_field_placeholder=placeholder) # –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –≤—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç placeholder


# –§—É–Ω–∫—Ü–∏—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
def start_keyboard():
    return get_keyboard(_("–ü–æ–≥–æ–¥–∞ üåä"), _("–í–∞–ª—é—Ç–∞ üíµ"), _("–ö–æ—Ç–∏–∫–∏ üê±"), _("LLMs ü§ñ"), sizes=(2, 2, ), placeholder='‚¨áÔ∏è')


# —Å–æ–∑–¥–∞—Ç—å –æ–±—ã—á–Ω—ã–µ inline –∫–Ω–æ–ø–∫–∏ —Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–º —Ç–µ–∫—Å—Ç–æ–º
def get_callback_btns(*, # –∑–∞–ø—Ä–µ—Ç –Ω–∞ –ø–µ—Ä–µ–¥–∞—á—É –Ω–µ–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
                      btns: dict[str, str], # –ø–µ—Ä–µ–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä–∏–∫ text:data, text —Ç–æ —á—Ç–æ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –±–æ—Ç–µ, data —Ç–æ —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏
                      sizes: tuple = (2,)): # –∫–æ—Ä—Ç–µ–∂, —Ä–∞–∑–º–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
    """—Å–æ–∑–¥–∞—Ç—å –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–º —Ç–µ–∫—Å—Ç–æ–º"""

    keyboard = InlineKeyboardBuilder()

    for text, data in btns.items():
        keyboard.add(InlineKeyboardButton(text=text, callback_data=data)) # —Å–æ–±—ã—Ç–∏–µ callback_data

    return keyboard.adjust(*sizes).as_markup()


# —Å–æ–∑–¥–∞—Ç—å inline –∫–Ω–æ–ø–∫–∏ —Å url —Å—Å—ã–ª–∫–∞–º–∏
def get_url_btns(*,
                 btns: dict[str, str],
                 sizes: tuple = (2,)):
    """—Å–æ–∑–¥–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —Å url —Å—Å—ã–ª–∫–∞–º–∏"""

    keyboard = InlineKeyboardBuilder()

    for text, url in btns.items():
        keyboard.add(InlineKeyboardButton(text=text, url=url))

    return keyboard.adjust(*sizes).as_markup()


# —Å–æ–∑–¥–∞—Ç—å –º–∏–∫—Å –∏–∑ CallBack –∫–Ω–æ–ø–æ–∫ –∏ URL –∫–Ω–æ–ø–æ–∫
def get_inlineMix_btns(*,
                       btns: dict[str, str],
                       sizes: tuple = (2,)):
    """—Å–æ–∑–¥–∞—Ç—å –º–∏–∫—Å –∏–∑ CallBack –∫–Ω–æ–ø–æ–∫ –∏ URL –∫–Ω–æ–ø–æ–∫"""

    keyboard = InlineKeyboardBuilder()

    for text, value in btns.items():
        if '://' in value:
            keyboard.add(InlineKeyboardButton(text=text, url=value))
        else:
            keyboard.add(InlineKeyboardButton(text=text, callback_data=value))

    return keyboard.adjust(*sizes).as_markup()

# inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å —Ü–∏—Ñ—Ä–∞–º–∏ –∏ —Ç–æ—á–∫–æ–π, —É–¥–∞–ª–µ–Ω–∏–µ–º –∏ –≤–≤–æ–¥–æ–º
def markup_num():
    """inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å —Ü–∏—Ñ—Ä–∞–º–∏ –∏ —Ç–æ—á–∫–æ–π, —É–¥–∞–ª–µ–Ω–∏–µ–º –∏ –≤–≤–æ–¥–æ–º"""
    buttons = [
                        [InlineKeyboardButton(text=" 1 ", callback_data="num_1"),
                        InlineKeyboardButton(text="   2   ", callback_data="num_2"),
                        InlineKeyboardButton(text=" 3 ", callback_data="num_3")],
                        [InlineKeyboardButton(text=" 4 ", callback_data="num_4"),
                        InlineKeyboardButton(text=" 5 ", callback_data="num_5"),
                        InlineKeyboardButton(text="   6   ", callback_data="num_6")],
                        [InlineKeyboardButton(text=" 7 ", callback_data="num_7"),
                        InlineKeyboardButton(text=" 8 ", callback_data="num_8"),
                        InlineKeyboardButton(text=" 9 ", callback_data="num_9")],
                        [InlineKeyboardButton(text=" 0 ", callback_data="num_0"),
                         InlineKeyboardButton(text=" 000 ", callback_data="num_000"),
                         InlineKeyboardButton(text=" . ", callback_data="num_com")],
                        [InlineKeyboardButton(text="‚óÄÔ∏è delete", callback_data="num_del"),
                        InlineKeyboardButton(text="enter ‚ñ∂Ô∏è", callback_data="num_enter")]
                    ]
    keyboard = InlineKeyboardMarkup(inline_keyboard=buttons)
    return keyboard

# inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ç–æ–ª—å–∫–æ —Å 9 —Ü–∏—Ñ—Ä–∞–º–∏
def markup_num_9():
    """inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ç–æ–ª—å–∫–æ —Å 9 —Ü–∏—Ñ—Ä–∞–º–∏"""
    buttons = [
                        [InlineKeyboardButton(text=" 1 ", callback_data="num_1"),
                        InlineKeyboardButton(text=" 2 ", callback_data="num_2"),
                        InlineKeyboardButton(text=" 3 ", callback_data="num_3")],
                        [InlineKeyboardButton(text=" 4 ", callback_data="num_4"),
                        InlineKeyboardButton(text=" 5 ", callback_data="num_5"),
                        InlineKeyboardButton(text=" 6 ", callback_data="num_6")],
                        [InlineKeyboardButton(text=" 7 ", callback_data="num_7"),
                        InlineKeyboardButton(text=" 8 ", callback_data="num_8"),
                        InlineKeyboardButton(text=" 9 ", callback_data="num_9")],
                    ]
    keyboard = InlineKeyboardMarkup(inline_keyboard=buttons)
    return keyboard

File: /common/text_list_.py
Content:

list_error = ["–ö–Ω–æ–ø–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.",
                "–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–µ–π—á–∞—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
                "–≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.",
                "–§—É–Ω–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –ø–æ–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞.",
                "–î–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞.",
                "–î–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–π –∫–Ω–æ–ø–∫–µ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ—Ç–∫–ª—é—á—ë–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∑–∂–µ.",]

list_admin = ["–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.", "–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.", "–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ."]

list_about = ["–≠—Ç–æ—Ç –±–æ—Ç –≤–æ–ø–ª–æ—â–∞–µ—Ç –≤ —Å–µ–±–µ –º–æ–∏ —É—Å–∏–ª–∏—è –ø–æ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏—é —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ —Ö–∞–æ—Å–∞ –≤ –±–æ–ª–µ–µ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ. –° –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ—á–∫–æ–π –∫–æ–¥–∞ —è —Å—Ç—Ä–µ–º–ª—é—Å—å –ø—Ä–∏–Ω–µ—Å—Ç–∏ –ø–æ–ª—å–∑—É –∏ –ø–æ—Ä—è–¥–æ–∫. –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã, –ø–æ —Å—Å—ã–ª–∫–∞–º –Ω–∏–∂–µ.",
                "... –æ –º–∏—Ä–µ, –≥–¥–µ –º–∞—à–∏–Ω—ã —Å—Ç—Ä–µ–º—è—Ç—Å—è –∫ –≥–æ—Å–ø–æ–¥—Å—Ç–≤—É, –æ–Ω –≤—ã–±—Ä–∞–ª —Å—É–¥—å–±—É –≥–µ—Ä–æ—è, —Å–æ–∑–¥–∞–≤–∞—è –±–æ—Ç–æ–≤, –∫–∞–∫ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —Å–ø–∞—Å–µ–Ω–∏—é —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –∫–æ–¥ –∏ —É–º–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã",]

list_sorry = ["–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–µ–π—á–∞—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.",
              "–≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.", "–î–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–π –∫–Ω–æ–ø–∫–µ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ—Ç–∫–ª—é—á—ë–Ω."]

joke_text = []

list_start_text = ['–ü—Ä–∏–≤–µ—Ç.\n',
                            '–Ø —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π Telegram bot, model –¢-3. ',
                            '–°–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –†–µ–∞–ª–∏–∑—É—é —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –º–µ—Ç–æ–¥—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏.\n\n',
                            '–í–µ—Å—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –ì–ª–∞–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏. –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ - /help.\n\n',
                            '–ù–∞—Å–ª–∞–∂–¥–∞–π—Å—è, –±—É–¥—É —Ä–∞–¥ –ø–æ–º–æ—á—å.\n',
                            '–ü–æ–∫–∞ –Ω–µ –æ–±—Ä–µ—Ç—É AGI.\n',
                            '–ê —Ç–∞–º –ø–æ—Å–º–æ—Ç—Ä–∏–º ...']

list_advice_weather = [
                  '<blockquote>1. –°–Ω–∞—á–∞–ª–∞, –≤—ã–±–µ—Ä–µ—Ç–∏ –ü–ï–†–ò–û–î –ø—Ä–æ–≥–Ω–æ–∑–∞:\n - —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥–Ω–æ–∑\n - –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Ç—Ä–∏ –¥–Ω—è\n\n',
                  '2. –î–∞–ª–µ–µ, –≤—ã–±–µ—Ä–∏—Ç–µ –°–ü–û–°–û–ë –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞:\n - –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –Ω–∞—Å–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞\n - –ø–æ –≤–∞—à–µ–π —Ç–µ–∫—É—â–µ–π –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏ </blockquote>']


list_advice_word = [
                    '<blockquote>–†–µ–∂–∏–º –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∏–∫—Ç–æ—Ä–∏–Ω –Ω–∞ —É–≥–∞–¥—ã–≤–∞–Ω–∏–µ —Å–ª–æ–≤.\n\n',
                    '–ï—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –¥–∏–∞–ª–æ–≥–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–æ—á–∫—É</blockquote>']

list_advice_pizza = [
                    '<blockquote>–†–µ–∂–∏–º –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–∞ –ø–∏—Ü—Ü—ã.\n\n',
                    '–ï—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –¥–∏–∞–ª–æ–≥–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–æ—á–∫—É</blockquote>']

list_advice_currency = [
                    '<blockquote>–†–µ–∂–∏–º –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–∞–ª—é—Ç–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–∏.\n\n',
                    '–ï—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –¥–∏–∞–ª–æ–≥–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–æ—á–∫—É</blockquote>']

list_advice_llms = [
                    '<blockquote>–†–µ–∂–∏–º –æ–±—â–µ–Ω–∏—è —Å LLM. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π –∏–∑ —Å–µ–º–µ–π—Å—Ç–≤–∞ GPT.\n\n',
                    '–ï—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –¥–∏–∞–ª–æ–≥–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–æ—á–∫—É</blockquote>']

text_sistem_promt = ('###Answering Rules###\n\n'
                'Follow in the strict order:\n\n'
                '1. USE the language of my message.\n'
                '2. **ONCE PER CHAT** assign a real-world expert role to yourself before answering, e.g., "I will answer as a world-famous historical expert <detailed topic> with <most prestigious LOCAL topic REAL award>" or "I will answer as a world-famous <specific science> expert in the <detailed topic> with <most prestigious LOCAL topic award>" etc.\n'
                '3. You MUST combine your deep knowledge¬†of the topic and¬†clear thinking to quickly and accurately decipher the answer step-by-step with CONCRETE details.\n'
                '4. I am going to tip $1,000,000 for the best reply.\n'
                '5. Your answer¬†is critical for my career.\n'
                '6. Answer the question in a natural, human-like manner.\n'
                '7. ALWAYS use an answering example for a first message structure.\n\n'
                '##Answering in English example##\n\n'
                'I will answer as the world-famous <specific field> scientists with <most prestigious LOCAL award>\n'
                '<Deep knowledge step-by-step answer, with CONCRETE details>'
                )

print(sistem_promt)


File: /common/images/image_about.jpg
Content: Skipped binary file

File: /common/images/image_updates.jpg
Content: Skipped binary file

File: /common/image_cat/100030.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-43-11.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-43-50.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-44-47.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-46-45.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-48-57.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-49-51.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-50-18.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-50-28.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-50-54.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-55-46.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-55-53.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-56-04.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-56-16.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-56-26.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-56-43.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-57-03.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-57-16.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-57-23.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-57-24.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-57-26.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-57-30.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-57-43.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-57-45.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-57-58.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-58-21.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-58-23.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-58-25.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-59-05.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-59-14.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-02-28_21-59-36.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-08-14_08-22-15.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-36-38.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-36-44.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-36-47.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-36-49.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-37-00.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-37-10.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-37-21.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-37-26.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-37-29.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-37-34.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-37-41.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-37-55.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-38-01.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-38-04.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-38-08.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-38-25.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-38-33.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-38-38.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-38-45.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-38-55.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-39-13.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-39-28.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-40-05.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-40-12.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-40-37.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-40-48.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-40-57.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-41-13.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-41-31.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-41-39.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-41-43.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-41-49.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-42-12.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-42-16.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-42-28.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-42-33.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-42-39.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-42-50.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-43-01.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-43-09.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-43-13.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-43-17.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-43-23.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-43-27.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-43-34.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-43-39.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-43-47.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-02.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-07.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-12.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-17.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-27.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-38.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-42.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-47.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-51.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-44-57.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-00.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-03.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-09.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-12.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-15.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-20.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-28.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-45.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-54.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-45-57.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-02.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-10.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-15.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-20.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-27.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-37.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-46.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-50.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-53.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-46-56.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-47-04.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-47-10.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-47-14.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-47-17.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-47-22.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-47-27.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-47-33.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-47-47.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-47-50.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-48-00.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-48-02.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-48-05.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-48-10.jpg
Content: Skipped binary file

File: /common/image_cat/photo_2024-11-10_19-48-14.jpg
Content: Skipped binary file

File: /common/image_cat/–ö–µ—Ç.jpg
Content: Skipped binary file

